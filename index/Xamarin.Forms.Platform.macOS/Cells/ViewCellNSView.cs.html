<!DOCTYPE html>
<html><head><title>ViewCellNSView.cs</title><link rel="stylesheet" href="../../styles.css"><script src="../../scripts.js"></script></head>
<body class="cB" onload="i(110);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="Xamarin.Forms.Platform.macOS/Cells/ViewCellNSView.cs" target="_top">Cells\ViewCellNSView.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xamarin.Forms.Platform.macOS" target="_top">Xamarin.Forms.Platform.MacOS\Xamarin.Forms.Platform.MacOS.csproj</a> (Xamarin.Forms.Platform.macOS)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">AppKit</span>;
<b>using</b> <span class="t">RectangleF</span> = <span class="i n">CoreGraphics</span>.<span class="t t">CGRect</span>;
 
<b>namespace</b> <span class="i n">Xamarin</span>.<span class="i n">Forms</span>.<span class="i n">Platform</span>.<span class="i n">MacOS</span>
{
	<b>internal class</b> <a id="d90a74a43063ba5e" href="../R/d90a74a43063ba5e.html" target="n" data-glyph="2,0" class="t t">ViewCellNSView</a> : <a href="CellNSView.cs.html#6881c9dd68ad7a1e" class="t t">CellNSView</a>
	{
		<b>public</b> <a id="a5480f36dc0b0edf" href="../R/a5480f36dc0b0edf.html" target="n" data-glyph="72,1" class="i constructor">ViewCellNSView</a>() : <a href="CellNSView.cs.html#c437de7c46cf6e7e" class="k">base</a>(<a href="NSTableViewCellStyle.cs.html#f11dacabaf9733c7" class="t t">NSTableViewCellStyle</a>.<a href="NSTableViewCellStyle.cs.html#1097e4ccebccf840" class="i field">Empty</a>)
		{
 
		}
 
		<a href="@0@mscorlib/A.html#809df5135c2bec67" class="t t">WeakReference</a>&lt;<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="t t">IVisualElementRenderer</a>&gt; <a id="2db09cb28827d569" href="../R/2db09cb28827d569.html" target="n" data-glyph="46,1" class="i field">_rendererRef</a>;
 
		<a href="/Xamarin.Forms.Core/A.html#080f860d2adf2a57" class="t t">ViewCell</a> <a id="3fc916d843852f5d" href="../R/3fc916d843852f5d.html" target="n" data-glyph="46,1" class="i field">_viewCell</a>;
 
		<b>public override</b> <a href="/Xamarin.Forms.Core/A.html#76098df8350c0484" class="t t">Element</a> <a id="fd7957e4bbfdb098" href="../R/fd7957e4bbfdb098.html" target="n" data-glyph="102,1" class="i property">Element</a> =&gt; <a href="#e1e926cc32baed8f" class="i property">ViewCell</a>;
 
		<b>public</b> <a href="/Xamarin.Forms.Core/A.html#080f860d2adf2a57" class="t t">ViewCell</a> <a id="e1e926cc32baed8f" href="../R/e1e926cc32baed8f.html" target="n" data-glyph="102,1" class="i property">ViewCell</a>
		{
			<b>get</b> { <b>return</b> <a href="#3fc916d843852f5d" class="i field">_viewCell</a>; }
			<b>set</b>
			{
				<b>if</b> (<a href="#3fc916d843852f5d" class="i field">_viewCell</a> == <b>value</b>)
					<b>return</b>;
				<a href="#d91b591e551eeb66" class="i method">UpdateCell</a>(<b>value</b>);
			}
		}
 
		<b>public override void</b> <a id="6537290ee4b6700e" href="../R/6537290ee4b6700e.html" target="n" data-glyph="72,1" class="i method">Layout</a>()
		{
			<a href="#b8621543fe07dbe7" class="i method">LayoutSubviews</a>();
			<a href="CellNSView.cs.html#6881c9dd68ad7a1e" class="k">base</a>.<a href="CellNSView.cs.html#3757a2f8511b755e" class="i method">Layout</a>();
		}
 
		<b>protected override void</b> <a id="50b4542b670ae837" href="../R/50b4542b670ae837.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r0 rd" class="r0 r">disposing</span>)
		{
			<b>if</b> (<span class="r0 r">disposing</span>)
			{
				<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="t t">IVisualElementRenderer</a> <span id="r1 rd" class="r1 r">renderer</span>;
				<b>if</b> (<a href="#2db09cb28827d569" class="i field">_rendererRef</a> != <b>null</b> &amp;&amp; <a href="#2db09cb28827d569" class="i field">_rendererRef</a>.<a href="@0@mscorlib/A.html#655561bce79c86cd" class="i method">TryGetTarget</a>(<b>out</b> <span class="r1 r">renderer</span>) &amp;&amp; <span class="r1 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#7d0d13bd54221563" class="i property">Element</a> != <b>null</b>)
				{
					<a href="../Platform.cs.html#be5a9b7035992ac3" class="t t">Platform</a>.<a href="../Platform.cs.html#0029c28006e0bcc1" class="i method">DisposeModelAndChildrenRenderers</a>(<span class="r1 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#7d0d13bd54221563" class="i property">Element</a>);
 
					<a href="#2db09cb28827d569" class="i field">_rendererRef</a> = <b>null</b>;
				}
			}
 
			<a href="CellNSView.cs.html#6881c9dd68ad7a1e" class="k">base</a>.<span class="i method">Dispose</span>(<span class="r0 r">disposing</span>);
		}
 
		<b>void</b> <a id="b8621543fe07dbe7" href="../R/b8621543fe07dbe7.html" target="n" data-glyph="76,1" class="i method">LayoutSubviews</a>()
		{
			<b>var</b> <span id="r2 rd" class="r2 r">contentFrame</span> = <span class="i property">Frame</span>;
			<a href="/Xamarin.Forms.Core/A.html#60f54d5b73cefedd" class="k">var</a> <span id="r3 rd" class="r3 r">view</span> = <a href="#e1e926cc32baed8f" class="i property">ViewCell</a>.<a href="/Xamarin.Forms.Core/A.html#7e0120b037b3522c" class="i property">View</a>;
 
			<span class="i n">Xamarin</span>.<span class="i n">Forms</span>.<a href="/Xamarin.Forms.Core/A.html#63eb70469ecf4413" class="t t">Layout</a>.<a href="/Xamarin.Forms.Core/A.html#7ef8e1dd509efc78" class="i method">LayoutChildIntoBoundingRegion</a>(<span class="r3 r">view</span>, <span class="r2 r">contentFrame</span>.<a href="../Extensions/ColorExtensions.cs.html#3aa6b2815654eaa9" class="i method">ToRectangle</a>());
 
			<b>if</b> (<a href="#2db09cb28827d569" class="i field">_rendererRef</a> == <b>null</b>)
				<b>return</b>;
 
			<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="t t">IVisualElementRenderer</a> <span id="r4 rd" class="r4 r">renderer</span>;
			<b>if</b> (<a href="#2db09cb28827d569" class="i field">_rendererRef</a>.<a href="@0@mscorlib/A.html#655561bce79c86cd" class="i method">TryGetTarget</a>(<b>out</b> <span class="r4 r">renderer</span>))
				<span class="r4 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#cc642a2f9731ed4a" class="i property">NativeView</a>.<span class="i property">Frame</span> = <span class="r3 r">view</span>.<a href="/Xamarin.Forms.Core/A.html#0e284b498897247f" class="i property">Bounds</a>.<a href="../Extensions/ColorExtensions.cs.html#e573ea78fb8289be" class="i method">ToRectangleF</a>();
		}
 
		<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="t t">IVisualElementRenderer</a> <a id="71aa4be9d7ed5405" href="../R/71aa4be9d7ed5405.html" target="n" data-glyph="76,1" class="i method">GetNewRenderer</a>()
		{
			<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="k">var</a> <span id="r5 rd" class="r5 r">newRenderer</span> = <a href="../Platform.cs.html#be5a9b7035992ac3" class="t t">Platform</a>.<a href="../Platform.cs.html#bd37e2314b2cee5c" class="i method">CreateRenderer</a>(<a href="#3fc916d843852f5d" class="i field">_viewCell</a>.<a href="/Xamarin.Forms.Core/A.html#7e0120b037b3522c" class="i property">View</a>);
			<a href="#2db09cb28827d569" class="i field">_rendererRef</a> = <b>new</b> <a href="@0@mscorlib/A.html#0bcc5ece65ea67eb" class="t constructor">WeakReference</a>&lt;<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="t t">IVisualElementRenderer</a>&gt;(<span class="r5 r">newRenderer</span>);
			<span class="i method">AddSubview</span>(<span class="r5 r">newRenderer</span>.<a href="../IVisualElementRenderer.cs.html#cc642a2f9731ed4a" class="i property">NativeView</a>);
			<b>return</b> <span class="r5 r">newRenderer</span>;
		}
 
		<b>void</b> <a id="d91b591e551eeb66" href="../R/d91b591e551eeb66.html" target="n" data-glyph="76,1" class="i method">UpdateCell</a>(<a href="/Xamarin.Forms.Core/A.html#080f860d2adf2a57" class="t t">ViewCell</a> <span id="r6 rd" class="r6 r">cell</span>)
		{
			<b>if</b> (<a href="#3fc916d843852f5d" class="i field">_viewCell</a> != <b>null</b>)
				<a href="/Xamarin.Forms.Core/A.html#4809323d42d3030a" class="t t">Device</a>.<a href="/Xamarin.Forms.Core/A.html#c01f48f642e0b305" class="i method">BeginInvokeOnMainThread</a>(<a href="#3fc916d843852f5d" class="i field">_viewCell</a>.<a href="/Xamarin.Forms.Core/A.html#9a269aae86b7756c" class="i method">SendDisappearing</a>);
 
			<a href="#3fc916d843852f5d" class="i field">_viewCell</a> = <span class="r6 r">cell</span>;
 
			<a href="/Xamarin.Forms.Core/A.html#4809323d42d3030a" class="t t">Device</a>.<a href="/Xamarin.Forms.Core/A.html#c01f48f642e0b305" class="i method">BeginInvokeOnMainThread</a>(<a href="#3fc916d843852f5d" class="i field">_viewCell</a>.<a href="/Xamarin.Forms.Core/A.html#884674abe59f9ab2" class="i method">SendAppearing</a>);
 
			<a href="../IVisualElementRenderer.cs.html#06d80d1922189ea9" class="t t">IVisualElementRenderer</a> <span id="r7 rd" class="r7 r">renderer</span>;
			<b>if</b> (<a href="#2db09cb28827d569" class="i field">_rendererRef</a> == <b>null</b> || !<a href="#2db09cb28827d569" class="i field">_rendererRef</a>.<a href="@0@mscorlib/A.html#655561bce79c86cd" class="i method">TryGetTarget</a>(<b>out</b> <span class="r7 r">renderer</span>))
				<span class="r7 r">renderer</span> = <a href="#71aa4be9d7ed5405" class="i method">GetNewRenderer</a>();
			<b>else</b>
			{
				<b>if</b> (<span class="r7 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#7d0d13bd54221563" class="i property">Element</a> != <b>null</b> &amp;&amp; <span class="r7 r">renderer</span> == <a href="../Platform.cs.html#be5a9b7035992ac3" class="t t">Platform</a>.<a href="../Platform.cs.html#4ab37f9d1be4bc41" class="i method">GetRenderer</a>(<span class="r7 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#7d0d13bd54221563" class="i property">Element</a>))
					<span class="r7 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#7d0d13bd54221563" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#4b4f85fcc1a48118" class="i method">ClearValue</a>(<a href="../Platform.cs.html#be5a9b7035992ac3" class="t t">Platform</a>.<a href="../Platform.cs.html#b2ef9d8d0093a8c4" class="i field">RendererProperty</a>);
 
				<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="k">var</a> <span id="r8 rd" class="r8 r">type</span> = <span class="i n">Internals</span>.<a href="/Xamarin.Forms.Core/A.html#44c60787abb7ad29" class="t t">Registrar</a>.<a href="/Xamarin.Forms.Core/A.html#5f29d2ac0e30bd81" class="i property">Registered</a>.<a href="/Xamarin.Forms.Core/A.html#720a9bb98de06e80" class="i method">GetHandlerTypeForObject</a>(<a href="#3fc916d843852f5d" class="i field">_viewCell</a>.<a href="/Xamarin.Forms.Core/A.html#7e0120b037b3522c" class="i property">View</a>);
				<a href="@0@mscorlib/A.html#19b80e3318d9b184" class="k">var</a> <span id="r9 rd" class="r9 r">reflectableType</span> = <span class="r7 r">renderer</span> <b>as</b> <span class="i n">System</span>.<span class="i n">Reflection</span>.<a href="@0@mscorlib/A.html#19b80e3318d9b184" class="t t">IReflectableType</a>;
				<a href="@0@mscorlib/A.html#3d00eeab9feb80f3" class="k">var</a> <span id="r10 rd" class="r10 r">rendererType</span> = <span class="r9 r">reflectableType</span> != <b>null</b> ? <span class="r9 r">reflectableType</span>.<a href="@0@mscorlib/A.html#dcb0d45415227ae9" class="i method">GetTypeInfo</a>().<a href="@0@mscorlib/A.html#22cef495c0fb163c" class="i method">AsType</a>() : <span class="r7 r">renderer</span>.<a href="@0@mscorlib/A.html#4d73eb225aef8a61" class="i method">GetType</a>();
				<b>if</b> (<span class="r10 r">rendererType</span> == <span class="r8 r">type</span> || (<span class="r7 r">renderer</span> <b>is</b> <a href="../Renderers/DefaultRenderer.cs.html#b315752f27fada62" class="t t">DefaultRenderer</a> &amp;&amp; <span class="r8 r">type</span> == <b>null</b>))
					<span class="r7 r">renderer</span>.<a href="../IVisualElementRenderer.cs.html#36da1d688ea13cff" class="i method">SetElement</a>(<a href="#3fc916d843852f5d" class="i field">_viewCell</a>.<a href="/Xamarin.Forms.Core/A.html#7e0120b037b3522c" class="i property">View</a>);
				<b>else</b>
				{
					<span class="c">//when cells are getting reused the element could be already set to another cell</span>
					<span class="c">//so we should dispose based on the renderer and not the renderer.Element</span>
					<a href="../Platform.cs.html#be5a9b7035992ac3" class="t t">Platform</a>.<a href="../Platform.cs.html#85126350cd7614e1" class="i method">DisposeRendererAndChildren</a>(<span class="r7 r">renderer</span>);
					<span class="r7 r">renderer</span> = <a href="#71aa4be9d7ed5405" class="i method">GetNewRenderer</a>();
				}
			}
 
			<a href="../Platform.cs.html#be5a9b7035992ac3" class="t t">Platform</a>.<a href="../Platform.cs.html#7bbb46ae9aa0c447" class="i method">SetRenderer</a>(<a href="#3fc916d843852f5d" class="i field">_viewCell</a>.<a href="/Xamarin.Forms.Core/A.html#7e0120b037b3522c" class="i property">View</a>, <span class="r7 r">renderer</span>);
		}
	}
}</pre></td></tr></table></div></body></html>
