<!DOCTYPE html>
<html><head><title>ListViewRenderer.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(620);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="Xamarin.Forms.Platform.UAP/ListViewRenderer.cs" target="_top">ListViewRenderer.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xamarin.Forms.Platform.UAP" target="_top">Xamarin.Forms.Platform.UAP\Xamarin.Forms.Platform.UAP.csproj</a> (Xamarin.Forms.Platform.UAP)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<b>using</b> <span class="i">System</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Collections</span>.<span class="i">Generic</span>;
<b>using</b> <span class="i">System</span>.<span class="i">ComponentModel</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Linq</span>;
<b>using</b> <span class="i">System</span>.<span class="i">Threading</span>.<span class="i">Tasks</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">Foundation</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">System</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="i n">Controls</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="i n">Data</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="i n">Input</span>;
<b>using</b> <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="i n">Media</span>;
<b>using</b> <span class="t">WListView</span> = <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="i n">Controls</span>.<span class="t t">ListView</span>;
<b>using</b> <span class="t">WBinding</span> = <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="i n">Data</span>.<span class="t t">Binding</span>;
<b>using</b> <span class="t">WApp</span> = <span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="t t">Application</span>;
<b>using</b> <span class="i n">Xamarin</span>.<span class="i n">Forms</span>.<span class="i n">Internals</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">WINDOWS_UWP</span>
 
<b>namespace</b> <span class="i n">Xamarin</span>.<span class="i n">Forms</span>.<span class="i n">Platform</span>.<span class="i n">UWP</span>
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">
namespace Xamarin.Forms.Platform.WinRT
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
{
	<b>public class</b> <a id="938559595dd95f4d" href="R/938559595dd95f4d.html" target="n" data-glyph="0,0" class="t t"><span id="59f1045379fe0a87">ListViewRenderer</span></a> : <a href="ViewRenderer.cs.html#735fbd3baa0da48d" class="t t">ViewRenderer</a>&lt;<a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>, <span class="t t">FrameworkElement</span>&gt;
	{
		<a href="/Xamarin.Forms.Core/A.html#7d7c0ddfee2f7ca3" class="t t">ITemplatedItemsView</a>&lt;<a href="/Xamarin.Forms.Core/A.html#7706486019503b22" class="t t">Cell</a>&gt; <a id="abe61a51a1ac2629" href="R/abe61a51a1ac2629.html" target="n" data-glyph="106,1" class="i property">TemplatedItemsView</a> =&gt; <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>;
 
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">WINDOWS_UWP</span>
<span class="e">		public static readonly DependencyProperty HighlightWhenSelectedProperty = DependencyProperty.RegisterAttached(&quot;HighlightWhenSelected&quot;, typeof(bool), typeof(ListViewRenderer),
			new PropertyMetadata(false));
 
		public static bool GetHighlightWhenSelected(DependencyObject dependencyObject)
		{
			return (bool)dependencyObject.GetValue(HighlightWhenSelectedProperty);
		}
 
		public static void SetHighlightWhenSelected(DependencyObject dependencyObject, bool value)
		{
			dependencyObject.SetValue(HighlightWhenSelectedProperty, value);
		}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
		<b>protected</b> <span class="t t">WListView</span> <a id="40e89181127caa77" href="R/40e89181127caa77.html" target="n" data-glyph="105,1" class="i property">List</a> { <b>get</b>; <b>private set</b>; }
 
		<b>protected override void</b> <a id="557841d2d34a7bda" href="R/557841d2d34a7bda.html" target="n" data-glyph="75,1" class="i method">OnElementChanged</a>(<a href="VisualElementChangedEventArgs.cs.html#5dbe5ff3136591e6" class="t t">ElementChangedEventArgs</a>&lt;<a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>&gt; <span id="r0 rd" class="r0 r">e</span>)
		{
			<a href="ViewRenderer.cs.html#735fbd3baa0da48d" class="k">base</a>.<a href="ViewRenderer.cs.html#a8ccad330f3ed406" class="i method">OnElementChanged</a>(<span class="r0 r">e</span>);
 
			<b>if</b> (<span class="r0 r">e</span>.<a href="VisualElementChangedEventArgs.cs.html#f4b125153dbde1d7" class="i property">OldElement</a> != <b>null</b>)
			{
				<span class="r0 r">e</span>.<a href="VisualElementChangedEventArgs.cs.html#f4b125153dbde1d7" class="i property">OldElement</a>.<a href="/Xamarin.Forms.Core/A.html#b7f2960fb90d27ad" class="i">ItemSelected</a> -= <span class="i">OnElementItemSelected</span>;
				<span class="r0 r">e</span>.<a href="VisualElementChangedEventArgs.cs.html#f4b125153dbde1d7" class="i property">OldElement</a>.<a href="/Xamarin.Forms.Core/A.html#55534a7ecbfa5f31" class="i">ScrollToRequested</a> -= <span class="i">OnElementScrollToRequested</span>;
			}
 
			<b>if</b> (<span class="r0 r">e</span>.<a href="VisualElementChangedEventArgs.cs.html#eadadd421823a1eb" class="i property">NewElement</a> != <b>null</b>)
			{
				<span class="r0 r">e</span>.<a href="VisualElementChangedEventArgs.cs.html#eadadd421823a1eb" class="i property">NewElement</a>.<a href="/Xamarin.Forms.Core/A.html#b7f2960fb90d27ad" class="i">ItemSelected</a> += <span class="i">OnElementItemSelected</span>;
				<span class="r0 r">e</span>.<a href="VisualElementChangedEventArgs.cs.html#eadadd421823a1eb" class="i property">NewElement</a>.<a href="/Xamarin.Forms.Core/A.html#55534a7ecbfa5f31" class="i">ScrollToRequested</a> += <span class="i">OnElementScrollToRequested</span>;
 
				<b>if</b> (<a href="#40e89181127caa77" class="i property">List</a> == <b>null</b>)
				{
					<a href="#40e89181127caa77" class="i property">List</a> = <b>new</b> <span class="t">WListView</span>
					{
						<span class="i property">IsSynchronizedWithCurrentItem</span> = <b>false</b>,
						<span class="i">ItemTemplate</span> = (<span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="t t">DataTemplate</span>)<span class="t t">WApp</span>.<span class="i property">Current</span>.<span class="i property">Resources</span>[<span class="s">&quot;CellTemplate&quot;</span>],
						<span class="i">HeaderTemplate</span> = (<span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="t t">DataTemplate</span>)<span class="t t">WApp</span>.<span class="i property">Current</span>.<span class="i property">Resources</span>[<span class="s">&quot;View&quot;</span>],
						<span class="i">FooterTemplate</span> = (<span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="t t">DataTemplate</span>)<span class="t t">WApp</span>.<span class="i property">Current</span>.<span class="i property">Resources</span>[<span class="s">&quot;View&quot;</span>],
						<span class="i">ItemContainerStyle</span> = (<span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="t t">Style</span>)<span class="t t">WApp</span>.<span class="i property">Current</span>.<span class="i property">Resources</span>[<span class="s">&quot;FormsListViewItem&quot;</span>],
						<span class="i">GroupStyleSelector</span> = (<span class="t t">GroupStyleSelector</span>)<span class="t t">WApp</span>.<span class="i property">Current</span>.<span class="i property">Resources</span>[<span class="s">&quot;ListViewGroupSelector&quot;</span>]
					};
 
					<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">IsItemClickEnabled</span> = <b>true</b>;
					<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">ItemClick</span> += <span class="i">OnListItemClicked</span>;
 
					<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">SelectionChanged</span> += <span class="i">OnControlSelectionChanged</span>;
 
					<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">SetBinding</span>(<span class="t t">ItemsControl</span>.<span class="i property">ItemsSourceProperty</span>, <span class="s">&quot;&quot;</span>);
				}
 
				<span class="c">// WinRT throws an exception if you set ItemsSource directly to a CVS, so bind it.</span>
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">DataContext</span> = <b>new</b> <span class="t">CollectionViewSource</span> { <span class="i property">Source</span> = <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#5eab030fbef30e59" class="i property">ItemsSource</a>, <span class="i property">IsSourceGrouped</span> = <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#0b780b61bce76534" class="i property">IsGroupingEnabled</a> };
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">WINDOWS_UWP</span>
<span class="e">				var selected = Element.SelectedItem;
				if (selected != null)
					OnElementItemSelected(null, new SelectedItemChangedEventArgs(selected));
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
				<a href="#209431e4a53f1408" class="i method">UpdateGrouping</a>();
				<a href="#931526c1ebc298d5" class="i method">UpdateHeader</a>();
				<a href="#2e0c47e6b38ed83b" class="i method">UpdateFooter</a>();
				<a href="#77eb10b51f21f99d" class="i method">ClearSizeEstimate</a>();
			}
		}
 
		<b>protected override void</b> <a id="ee7e1ffebba11284" href="R/../../0000000000.html" target="n" data-glyph="75,1" class="i method">OnElementPropertyChanged</a>(<b>object</b> <span id="r1 rd" class="r1 r">sender</span>, <span class="i">PropertyChangedEventArgs</span> <span id="r2 rd" class="r2 r">e</span>)
		{
			<a href="ViewRenderer.cs.html#735fbd3baa0da48d" class="k">base</a>.<span class="i">OnElementPropertyChanged</span>(<span class="r1 r">sender</span>, <span class="r2 r">e</span>);
 
			<b>if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#036cd02de28b0419" class="i field">IsGroupingEnabledProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#209431e4a53f1408" class="i method">UpdateGrouping</a>();
			}
			<b>else if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#926e93cbfca7cdfc" class="i field">HeaderProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#931526c1ebc298d5" class="i method">UpdateHeader</a>();
			}
			<b>else if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#b11c3ee784de2a2e" class="i field">FooterProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#2e0c47e6b38ed83b" class="i method">UpdateFooter</a>();
			}
			<b>else if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#96072a718638095e" class="i field">RowHeightProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#77eb10b51f21f99d" class="i method">ClearSizeEstimate</a>();
			}
			<b>else if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#ba5f9bb59f0aeffc" class="i field">HasUnevenRowsProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#77eb10b51f21f99d" class="i method">ClearSizeEstimate</a>();
			}
			<b>else if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#ff5fcf02ddedda77" class="i field">ItemTemplateProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#77eb10b51f21f99d" class="i method">ClearSizeEstimate</a>();
			}
			<b>else if</b> (<span class="r2 r">e</span>.<span class="i">PropertyName</span> == <a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#ec65dccca42e4f36" class="i field">ItemsSourceProperty</a>.<a href="/Xamarin.Forms.Core/A.html#3e8a9f30dd5c9578" class="i property">PropertyName</a>)
			{
				<a href="#77eb10b51f21f99d" class="i method">ClearSizeEstimate</a>();
				((<span class="t t">CollectionViewSource</span>)<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">DataContext</span>).<span class="i property">Source</span> = <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#5eab030fbef30e59" class="i property">ItemsSource</a>;
			}
		}
 
		<b>protected override void</b> <a id="9f810e39fab8594e" href="R/9f810e39fab8594e.html" target="n" data-glyph="75,1" class="i method">Dispose</a>(<b>bool</b> <span id="r3 rd" class="r3 r">disposing</span>)
		{
			<b>if</b> (<a href="#40e89181127caa77" class="i property">List</a> != <b>null</b>)
			{
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">ItemClick</span> -= <span class="i">OnListItemClicked</span>;
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">SelectionChanged</span> -= <span class="i">OnControlSelectionChanged</span>;
 
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">DataContext</span> = <b>null</b>;
				<a href="#40e89181127caa77" class="i property">List</a> = <b>null</b>;
			}
 
			<b>if</b> (<a href="#7ad4db625cf803e3" class="i field">_zoom</a> != <b>null</b>)
			{
				<a href="#7ad4db625cf803e3" class="i field">_zoom</a>.<span class="i">ViewChangeCompleted</span> -= <span class="i">OnViewChangeCompleted</span>;
				<a href="#7ad4db625cf803e3" class="i field">_zoom</a> = <b>null</b>;
			}
 
			<a href="ViewRenderer.cs.html#735fbd3baa0da48d" class="k">base</a>.<a href="VisualElementRenderer.cs.html#3261b3460031ee07" class="i method">Dispose</a>(<span class="r3 r">disposing</span>);
		}
 
		<b>static</b> <span class="i">IEnumerable</span>&lt;<span class="r4 r t">T</span>&gt; <a id="a90b35952e9c762d" href="R/a90b35952e9c762d.html" target="n" data-glyph="76,1" class="i method">FindDescendants</a>&lt;<span id="r4 rd t" class="r4 r t">T</span>&gt;(<span class="t t">DependencyObject</span> <span id="r5 rd" class="r5 r">dobj</span>) <b>where</b> <span class="r4 r t">T</span> : <span class="t t">DependencyObject</span>
		{
			<b>int</b> <span id="r6 rd" class="r6 r">count</span> = <span class="t t">VisualTreeHelper</span>.<span class="i">GetChildrenCount</span>(<span class="r5 r">dobj</span>);
			<b>for</b> (<b>var</b> <span id="r7 rd" class="r7 r">i</span> = 0; <span class="r7 r">i</span> &lt; <span class="r6 r">count</span>; <span class="r7 r">i</span>++)
			{
				<span class="t t">DependencyObject</span> <span id="r8 rd" class="r8 r">element</span> = <span class="t t">VisualTreeHelper</span>.<span class="i">GetChild</span>(<span class="r5 r">dobj</span>, <span class="r7 r">i</span>);
				<b>if</b> (<span class="r8 r">element</span> <b>is</b> <span class="r4 r t">T</span>)
					<b>yield return</b> (<span class="r4 r t">T</span>)<span class="r8 r">element</span>;
 
				<b>foreach</b> (<span class="r4 r t">T</span> <span id="r9 rd" class="r9 r">descendant</span> <b>in</b> <a href="#a90b35952e9c762d" class="i method">FindDescendants</a>&lt;<span class="r4 r t">T</span>&gt;(<span class="r8 r">element</span>))
					<b>yield return</b> <span class="r9 r">descendant</span>;
			}
		}
 
		<b>sealed class</b> <a id="4b6f2c4560ab3de7" href="R/4b6f2c4560ab3de7.html" target="n" data-glyph="4,1" class="t t">BrushedElement</a>
		{
			<b>public</b> <a id="ce96f28c2021ae14" href="R/../../0000000000.html" target="n" data-glyph="72,2" class="i constructor">BrushedElement</a>(<span class="t t">FrameworkElement</span> <span id="r10 rd" class="r10 r">element</span>, <span class="t t">WBinding</span> <span id="r11 rd" class="r11 r">brushBinding</span> = <b>null</b>, <span class="t t">Brush</span> <span id="r12 rd" class="r12 r">brush</span> = <b>null</b>)
			{
				<a href="#ebe4cdfd6f295ecd" class="i property">Element</a> = <span class="r10 r">element</span>;
				<a href="#224f78d189a7db87" class="i property">BrushBinding</a> = <span class="r11 r">brushBinding</span>;
				<a href="#f0bb2e322966ddd8" class="i property">Brush</a> = <span class="r12 r">brush</span>;
			}
 
			<b>public</b> <span class="t t">Brush</span> <a id="f0bb2e322966ddd8" href="R/f0bb2e322966ddd8.html" target="n" data-glyph="102,2" class="i property">Brush</a> { <b>get</b>; }
 
			<b>public</b> <span class="t t">WBinding</span> <a id="224f78d189a7db87" href="R/224f78d189a7db87.html" target="n" data-glyph="102,2" class="i property">BrushBinding</a> { <b>get</b>; }
 
			<b>public</b> <span class="t t">FrameworkElement</span> <a id="ebe4cdfd6f295ecd" href="R/ebe4cdfd6f295ecd.html" target="n" data-glyph="102,2" class="i property">Element</a> { <b>get</b>; }
 
			<b>public bool</b> <a id="e8ef5d11475d5657" href="R/../../0000000000.html" target="n" data-glyph="102,2" class="i property">IsBound</a>
			{
				<b>get</b> { <b>return</b> <a href="#224f78d189a7db87" class="i property">BrushBinding</a> != <b>null</b>; }
			}
		}
 
		<span class="t t">SemanticZoom</span> <a id="7ad4db625cf803e3" href="R/7ad4db625cf803e3.html" target="n" data-glyph="46,1" class="i field">_zoom</a>;
		<span class="t t">ScrollViewer</span> <a id="0d1da7b7756dc360" href="R/0d1da7b7756dc360.html" target="n" data-glyph="46,1" class="i field">_scrollViewer</a>;
		<span class="t t">ContentControl</span> <a id="99ed73e381a161a1" href="R/99ed73e381a161a1.html" target="n" data-glyph="46,1" class="i field">_headerControl</a>;
		<b>readonly</b> <span class="i">List</span>&lt;<a href="#4b6f2c4560ab3de7" class="t t">BrushedElement</a>&gt; <a id="5aaea92756048c7e" href="R/../../0000000000.html" target="n" data-glyph="46,1" class="i field">_highlightedElements</a> = <b>new</b> <span class="i">List</span>&lt;<a href="#4b6f2c4560ab3de7" class="t t">BrushedElement</a>&gt;();
 
		<b>void</b> <a id="77eb10b51f21f99d" href="R/77eb10b51f21f99d.html" target="n" data-glyph="76,1" class="i method">ClearSizeEstimate</a>()
		{
			<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<span class="i">ClearValue</span>(<a href="CellControl.cs.html#ec8f0790cb2e268e" class="t t">CellControl</a>.<a href="CellControl.cs.html#66862bc309d53b2e" class="i field">MeasuredEstimateProperty</a>);
		}
 
		<b>void</b> <a id="2e0c47e6b38ed83b" href="R/2e0c47e6b38ed83b.html" target="n" data-glyph="76,1" class="i method">UpdateFooter</a>()
		{
			<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">Footer</span> = <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#e489121e054c62f7" class="i property">FooterElement</a>;
		}
 
		<b>void</b> <a id="931526c1ebc298d5" href="R/931526c1ebc298d5.html" target="n" data-glyph="76,1" class="i method">UpdateHeader</a>()
		{
			<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">Header</span> = <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#7ca6df286ce3f9a6" class="i property">HeaderElement</a>;
		}
 
		<b>void</b> <a id="209431e4a53f1408" href="R/209431e4a53f1408.html" target="n" data-glyph="76,1" class="i method">UpdateGrouping</a>()
		{
			<b>bool</b> <span id="r13 rd" class="r13 r">grouping</span> = <a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#0b780b61bce76534" class="i property">IsGroupingEnabled</a>;
 
			((<span class="t t">CollectionViewSource</span>)<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">DataContext</span>).<span class="i property">IsSourceGrouped</span> = <span class="r13 r">grouping</span>;
 
			<a href="/Xamarin.Forms.Core/A.html#5fafd275375b1472" class="k">var</a> <span id="r14 rd" class="r14 r">templatedItems</span> = <a href="#abe61a51a1ac2629" class="i property">TemplatedItemsView</a>.<a href="/Xamarin.Forms.Core/A.html#5c03fae343562417" class="i property">TemplatedItems</a>;
			<b>if</b> (<span class="r13 r">grouping</span> &amp;&amp; <span class="r14 r">templatedItems</span>.<a href="/Xamarin.Forms.Core/A.html#698b3d0a651f405a" class="i property">ShortNames</a> != <b>null</b>)
			{
				<b>if</b> (<a href="#7ad4db625cf803e3" class="i field">_zoom</a> == <b>null</b>)
				{
					<span class="t t">ScrollViewer</span>.<span class="i">SetIsVerticalScrollChainingEnabled</span>(<a href="#40e89181127caa77" class="i property">List</a>, <b>false</b>);
 
					<b>var</b> <span id="r15 rd" class="r15 r">grid</span> = <b>new</b> <span class="t">GridView</span> { <span class="i property">ItemsSource</span> = <span class="r14 r">templatedItems</span>.<a href="/Xamarin.Forms.Core/A.html#698b3d0a651f405a" class="i property">ShortNames</a>, <span class="i">Style</span> = (<span class="i n">Windows</span>.<span class="i n">UI</span>.<span class="i n">Xaml</span>.<span class="t t">Style</span>)<span class="t t">WApp</span>.<span class="i property">Current</span>.<span class="i property">Resources</span>[<span class="s">&quot;JumpListGrid&quot;</span>] };
 
					<span class="t t">ScrollViewer</span>.<span class="i">SetIsHorizontalScrollChainingEnabled</span>(<span class="r15 r">grid</span>, <b>false</b>);
 
					<a href="#7ad4db625cf803e3" class="i field">_zoom</a> = <b>new</b> <span class="t">SemanticZoom</span> { <span class="i property">IsZoomOutButtonEnabled</span> = <b>false</b>, <span class="i">ZoomedOutView</span> = <span class="r15 r">grid</span> };
 
					<span class="c">// Since we reuse our ScrollTo, we have to wait until the change completes or ChangeView has odd behavior.</span>
					<a href="#7ad4db625cf803e3" class="i field">_zoom</a>.<span class="i">ViewChangeCompleted</span> += <span class="i">OnViewChangeCompleted</span>;
 
					<span class="c">// Specific order to let SNC unparent the ListView for us</span>
					<a href="VisualElementRenderer.cs.html#b7d9ecfe67d11d6b" class="i method">SetNativeControl</a>(<a href="#7ad4db625cf803e3" class="i field">_zoom</a>);
					<a href="#7ad4db625cf803e3" class="i field">_zoom</a>.<span class="i">ZoomedInView</span> = <a href="#40e89181127caa77" class="i property">List</a>;
				}
				<b>else</b>
				{
					<a href="#7ad4db625cf803e3" class="i field">_zoom</a>.<span class="i property">CanChangeViews</span> = <b>true</b>;
				}
			}
			<b>else</b>
			{
				<b>if</b> (<a href="#7ad4db625cf803e3" class="i field">_zoom</a> != <b>null</b>)
					<a href="#7ad4db625cf803e3" class="i field">_zoom</a>.<span class="i property">CanChangeViews</span> = <b>false</b>;
				<b>else if</b> (<a href="#40e89181127caa77" class="i property">List</a> != <a href="VisualElementRenderer.cs.html#d16cdca2f91290e2" class="i property">Control</a>)
					<a href="VisualElementRenderer.cs.html#b7d9ecfe67d11d6b" class="i method">SetNativeControl</a>(<a href="#40e89181127caa77" class="i property">List</a>);
			}
		}
 
		<b>async void</b> <a id="de4c3a5ab6e969da" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OnViewChangeCompleted</a>(<b>object</b> <span id="r16 rd" class="r16 r">sender</span>, <span class="t t">SemanticZoomViewChangedEventArgs</span> <span id="r17 rd" class="r17 r">e</span>)
		{
			<b>if</b> (<span class="r17 r">e</span>.<span class="i property">IsSourceZoomedInView</span>)
				<b>return</b>;
 
			<span class="c">// HACK: Technically more than one short name could be the same, this will potentially find the wrong one in that case</span>
			<b>var</b> <span id="r18 rd" class="r18 r">item</span> = (<b>string</b>)<span class="r17 r">e</span>.<span class="i property">SourceItem</span>.<span class="i property">Item</span>;
 
			<a href="/Xamarin.Forms.Core/A.html#5fafd275375b1472" class="k">var</a> <span id="r19 rd" class="r19 r">templatedItems</span> = <a href="#abe61a51a1ac2629" class="i property">TemplatedItemsView</a>.<a href="/Xamarin.Forms.Core/A.html#5c03fae343562417" class="i property">TemplatedItems</a>;
			<b>int</b> <span id="r20 rd" class="r20 r">index</span> = <span class="r19 r">templatedItems</span>.<a href="/Xamarin.Forms.Core/A.html#698b3d0a651f405a" class="i property">ShortNames</a>.<span class="i">IndexOf</span>(<span class="r18 r">item</span>);
			<b>if</b> (<span class="r20 r">index</span> == -1)
				<b>return</b>;
 
			<a href="/Xamarin.Forms.Core/A.html#5fafd275375b1472" class="k">var</a> <span id="r21 rd" class="r21 r">til</span> = <span class="r19 r">templatedItems</span>.<span class="i">GetGroup</span>(<span class="r20 r">index</span>);
			<b>if</b> (<span class="r21 r">til</span>.<span class="i">Count</span> == 0)
				<b>return</b>; <span class="c">// FIXME</span>
 
			<span class="c">// Delay until after the SemanticZoom change _actually_ finishes, fixes tons of odd issues on Phone w/ virtualization.</span>
			<b>if</b> (<a href="/Xamarin.Forms.Core/A.html#4809323d42d3030a" class="t t">Device</a>.<a href="/Xamarin.Forms.Core/A.html#ecd1e66d4705505f" class="i property">Idiom</a> == <a href="/Xamarin.Forms.Core/A.html#642119abfd8db803" class="t t">TargetIdiom</a>.<a href="/Xamarin.Forms.Core/A.html#36a99c4c498ed83e" class="i field">Phone</a>)
				<b>await</b> <span class="i">Task</span>.<span class="i">Delay</span>(1);
 
			<a href="/Xamarin.Forms.Core/A.html#bb08d2d17017b22f" class="t t">IListProxy</a> <span id="r22 rd" class="r22 r">listProxy</span> = <span class="r21 r">til</span>.<a href="/Xamarin.Forms.Core/A.html#95cf81e423c7f190" class="i property">ListProxy</a>;
			<span class="i">ScrollTo</span>(<span class="r22 r">listProxy</span>.<a href="/Xamarin.Forms.Core/A.html#2a97343604d30bce" class="i property">ProxiedEnumerable</a>, <span class="r22 r">listProxy</span>[0], <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a>.<a href="/Xamarin.Forms.Core/A.html#78b3634b9c5b120a" class="i field">Start</a>, <b>true</b>, <b>true</b>);
		}
 
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">disable</span> 1998 <span class="c">// considered for removal</span>
		<b>async void</b> <a id="a693e6749098bce4" href="R/a693e6749098bce4.html" target="n" data-glyph="76,1" class="i method">ScrollTo</a>(<b>object</b> <span id="r23 rd" class="r23 r">group</span>, <b>object</b> <span id="r24 rd" class="r24 r">item</span>, <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a> <span id="r25 rd" class="r25 r">toPosition</span>, <b>bool</b> <span id="r26 rd" class="r26 r">shouldAnimate</span>, <b>bool</b> <span id="r27 rd" class="r27 r">includeGroup</span> = <b>false</b>, <b>bool</b> <span id="r28 rd" class="r28 r">previouslyFailed</span> = <b>false</b>)
<span class="k preprocess">#</span><span class="k preprocess">pragma</span> <span class="k preprocess">warning</span> <span class="k preprocess">restore</span> 1998
		{
			<span class="t t">ScrollViewer</span> <span id="r29 rd" class="r29 r">viewer</span> = <a href="#2ee142ad04dedd40" class="i method">GetScrollViewer</a>();
			<b>if</b> (<span class="r29 r">viewer</span> == <b>null</b>)
			{
				<span class="t t">RoutedEventHandler</span> <span id="r30 rd" class="r30 r">loadedHandler</span> = <b>null</b>;
				<span class="r30 r">loadedHandler</span> = <b>async</b> (<span id="r31 rd" class="r31 r">o</span>, <span id="r32 rd" class="r32 r">e</span>) =&gt;
				{
					<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">Loaded</span> -= <span class="r30 r">loadedHandler</span>;
 
					<span class="c">// Here we try to avoid an exception, see explanation at bottom</span>
					<b>await</b> <span class="i property">Dispatcher</span>.<span class="i">RunIdleAsync</span>(<span id="r33 rd" class="r33 r">args</span> =&gt; { <a href="#a693e6749098bce4" class="i method">ScrollTo</a>(<span class="r23 r">group</span>, <span class="r24 r">item</span>, <span class="r25 r">toPosition</span>, <span class="r26 r">shouldAnimate</span>, <span class="r27 r">includeGroup</span>); });
				};
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">Loaded</span> += <span class="r30 r">loadedHandler</span>;
				<b>return</b>;
			}
			<a href="/Xamarin.Forms.Core/A.html#5fafd275375b1472" class="k">var</a> <span id="r34 rd" class="r34 r">templatedItems</span> = <a href="#abe61a51a1ac2629" class="i property">TemplatedItemsView</a>.<a href="/Xamarin.Forms.Core/A.html#5c03fae343562417" class="i property">TemplatedItems</a>;
			<span class="i">Tuple</span>&lt;<b>int</b>, <b>int</b>&gt; <span id="r35 rd" class="r35 r">location</span> = <span class="r34 r">templatedItems</span>.<span class="i">GetGroupAndIndexOfItem</span>(<span class="r23 r">group</span>, <span class="r24 r">item</span>);
			<b>if</b> (<span class="r35 r">location</span>.<span class="i">Item1</span> == -1 || <span class="r35 r">location</span>.<span class="i">Item2</span> == -1)
				<b>return</b>;
 
			<b>object</b>[] <span id="r36 rd" class="r36 r">t</span> = <span class="r34 r">templatedItems</span>.<span class="i">GetGroup</span>(<span class="r35 r">location</span>.<span class="i">Item1</span>).<a href="/Xamarin.Forms.Core/A.html#ca765c504701ad64" class="i property">ItemsSource</a>.<span class="i">Cast</span>&lt;<b>object</b>&gt;().<span class="i">ToArray</span>();
			<b>object</b> <span id="r37 rd" class="r37 r">c</span> = <span class="r36 r">t</span>[<span class="r35 r">location</span>.<span class="i">Item2</span>];
 
			<b>double</b> <span id="r38 rd" class="r38 r">viewportHeight</span> = <span class="r29 r">viewer</span>.<span class="i property">ViewportHeight</span>;
 
			<b>var</b> <span id="r39 rd" class="r39 r">semanticLocation</span> = <b>new</b> <span class="t">SemanticZoomLocation</span> { <span class="i property">Item</span> = <span class="r37 r">c</span> };
 
			<b>switch</b> (<span class="r25 r">toPosition</span>)
			{
				<b>case</b> <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a>.<a href="/Xamarin.Forms.Core/A.html#78b3634b9c5b120a" class="i field">Start</a>:
					{
						<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">ScrollIntoView</span>(<span class="r37 r">c</span>, <span class="t t">ScrollIntoViewAlignment</span>.<span class="i field">Leading</span>);
						<b>return</b>;
					}
 
				<b>case</b> <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a>.<a href="/Xamarin.Forms.Core/A.html#6027307adab57e1b" class="i field">MakeVisible</a>:
					{
						<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">ScrollIntoView</span>(<span class="r37 r">c</span>, <span class="t t">ScrollIntoViewAlignment</span>.<span class="i field">Default</span>);
						<b>return</b>;
					}
 
				<b>case</b> <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a>.<a href="/Xamarin.Forms.Core/A.html#c986f9da5b8e7350" class="i field">End</a>:
				<b>case</b> <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a>.<a href="/Xamarin.Forms.Core/A.html#cf0e7d490192e01f" class="i field">Center</a>:
					{
						<b>var</b> <span id="r40 rd" class="r40 r">content</span> = (<span class="t t">FrameworkElement</span>)<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">ItemTemplate</span>.<span class="i method">LoadContent</span>();
						<span class="r40 r">content</span>.<span class="i property">DataContext</span> = <span class="r37 r">c</span>;
						<span class="r40 r">content</span>.<span class="i">Measure</span>(<b>new</b> <span class="i n">Windows</span>.<span class="i n">Foundation</span>.<span class="i">Size</span>(<span class="r29 r">viewer</span>.<span class="i property">ActualWidth</span>, <b>double</b>.<span class="i">PositiveInfinity</span>));
 
						<b>double</b> <span id="r41 rd" class="r41 r">tHeight</span> = <span class="r40 r">content</span>.<span class="i property">DesiredSize</span>.<span class="i">Height</span>;
 
						<b>if</b> (<span class="r25 r">toPosition</span> == <a href="/Xamarin.Forms.Core/A.html#5fb20af4e6e81b90" class="t t">ScrollToPosition</a>.<a href="/Xamarin.Forms.Core/A.html#cf0e7d490192e01f" class="i field">Center</a>)
							<span class="r39 r">semanticLocation</span>.<span class="i property">Bounds</span> = <b>new</b> <span class="i">Rect</span>(0, <span class="r38 r">viewportHeight</span> / 2 - <span class="r41 r">tHeight</span> / 2, 0, 0);
						<b>else</b>
							<span class="r39 r">semanticLocation</span>.<span class="i property">Bounds</span> = <b>new</b> <span class="i">Rect</span>(0, <span class="r38 r">viewportHeight</span> - <span class="r41 r">tHeight</span>, 0, 0);
 
						<b>break</b>;
					}
			}
 
			<span class="c">// Waiting for loaded doesn&#39;t seem to be enough anymore; the ScrollViewer does not appear until after Loaded.</span>
			<span class="c">// Even if the ScrollViewer is present, an invoke at low priority fails (E_FAIL) presumably because the items are</span>
			<span class="c">// still loading. An invoke at idle sometimes work, but isn&#39;t reliable enough, so we&#39;ll just have to commit</span>
			<span class="c">// treason and use a blanket catch for the E_FAIL and try again.</span>
			<b>try</b>
			{
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i">MakeVisible</span>(<span class="r39 r">semanticLocation</span>);
			}
			<b>catch</b> (<span class="i">Exception</span>)
			{
				<b>if</b> (<span class="r28 r">previouslyFailed</span>)
					<b>return</b>;
 
				<span class="i">Task</span>.<span class="i">Delay</span>(1).<span class="i">ContinueWith</span>(<span id="r42 rd" class="r42 r">ct</span> =&gt; { <a href="#a693e6749098bce4" class="i method">ScrollTo</a>(<span class="r23 r">group</span>, <span class="r24 r">item</span>, <span class="r25 r">toPosition</span>, <span class="r26 r">shouldAnimate</span>, <span class="r27 r">includeGroup</span>, <b>true</b>); }, <span class="i">TaskScheduler</span>.<span class="i">FromCurrentSynchronizationContext</span>()).<span class="i">WatchForError</span>();
			}
		}
 
		<b>void</b> <a id="3781bd27219b0feb" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OnElementScrollToRequested</a>(<b>object</b> <span id="r43 rd" class="r43 r">sender</span>, <a href="/Xamarin.Forms.Core/A.html#f03c2a98424144b5" class="t t">ScrollToRequestedEventArgs</a> <span id="r44 rd" class="r44 r">e</span>)
		{
			<a href="/Xamarin.Forms.Core/A.html#bbee832be42424be" class="k">var</a> <span id="r45 rd" class="r45 r">scrollArgs</span> = (<a href="/Xamarin.Forms.Core/A.html#bbee832be42424be" class="t t">ITemplatedItemsListScrollToRequestedEventArgs</a>)<span class="r44 r">e</span>;
			<span class="i">ScrollTo</span>(<span class="r45 r">scrollArgs</span>.<a href="/Xamarin.Forms.Core/A.html#57f314f5cc333237" class="i property">Group</a>, <span class="r45 r">scrollArgs</span>.<a href="/Xamarin.Forms.Core/A.html#2b6b4e5119bda668" class="i property">Item</a>, <span class="r44 r">e</span>.<a href="/Xamarin.Forms.Core/A.html#fc0ff6f15e752ead" class="i property">Position</a>, <span class="r44 r">e</span>.<a href="/Xamarin.Forms.Core/A.html#a431f3b81325da89" class="i property">ShouldAnimate</a>);
		}
 
		<span class="r46 r t">T</span> <a id="348ed40c44ccd83d" href="R/348ed40c44ccd83d.html" target="n" data-glyph="76,1" class="i method">GetFirstDescendant</a>&lt;<span id="r46 rd t" class="r46 r t">T</span>&gt;(<span class="t t">DependencyObject</span> <span id="r47 rd" class="r47 r">element</span>) <b>where</b> <span class="r46 r t">T</span> : <span class="t t">FrameworkElement</span>
		{
			<b>int</b> <span id="r48 rd" class="r48 r">count</span> = <span class="t t">VisualTreeHelper</span>.<span class="i">GetChildrenCount</span>(<span class="r47 r">element</span>);
			<b>for</b> (<b>var</b> <span id="r49 rd" class="r49 r">i</span> = 0; <span class="r49 r">i</span> &lt; <span class="r48 r">count</span>; <span class="r49 r">i</span>++)
			{
				<span class="t t">DependencyObject</span> <span id="r50 rd" class="r50 r">child</span> = <span class="t t">VisualTreeHelper</span>.<span class="i">GetChild</span>(<span class="r47 r">element</span>, <span class="r49 r">i</span>);
 
				<span class="r46 r t">T</span> <span id="r51 rd" class="r51 r">target</span> = <span class="r50 r">child</span> <b>as</b> <span class="r46 r t">T</span> ?? <a href="#348ed40c44ccd83d" class="i method">GetFirstDescendant</a>&lt;<span class="r46 r t">T</span>&gt;(<span class="r50 r">child</span>);
				<b>if</b> (<span class="r51 r">target</span> != <b>null</b>)
					<b>return</b> <span class="r51 r">target</span>;
			}
 
			<b>return null</b>;
		}
 
		<span class="t t">ContentControl</span> <a id="0acd69e5ac8ca45d" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">GetHeaderControl</a>()
		{
			<b>if</b> (<a href="#99ed73e381a161a1" class="i field">_headerControl</a> == <b>null</b>)
			{
				<span class="t t">ScrollViewer</span> <span id="r52 rd" class="r52 r">viewer</span> = <a href="#2ee142ad04dedd40" class="i method">GetScrollViewer</a>();
				<b>if</b> (<span class="r52 r">viewer</span> == <b>null</b>)
					<b>return null</b>;
 
				<b>var</b> <span id="r53 rd" class="r53 r">presenter</span> = <a href="#348ed40c44ccd83d" class="i method">GetFirstDescendant</a>&lt;<span class="t t">ItemsPresenter</span>&gt;(<span class="r52 r">viewer</span>);
				<b>if</b> (<span class="r53 r">presenter</span> == <b>null</b>)
					<b>return null</b>;
 
				<a href="#99ed73e381a161a1" class="i field">_headerControl</a> = <a href="#348ed40c44ccd83d" class="i method">GetFirstDescendant</a>&lt;<span class="t t">ContentControl</span>&gt;(<span class="r53 r">presenter</span>);
			}
 
			<b>return</b> <a href="#99ed73e381a161a1" class="i field">_headerControl</a>;
		}
 
		<span class="t t">ScrollViewer</span> <a id="2ee142ad04dedd40" href="R/2ee142ad04dedd40.html" target="n" data-glyph="76,1" class="i method">GetScrollViewer</a>()
		{
			<b>if</b> (<a href="#0d1da7b7756dc360" class="i field">_scrollViewer</a> == <b>null</b>)
			{
				<a href="#0d1da7b7756dc360" class="i field">_scrollViewer</a> = <a href="#40e89181127caa77" class="i property">List</a>.<a href="FrameworkElementExtensions.cs.html#052a87239ea704b0" class="i method">GetFirstDescendant</a>&lt;<span class="t t">ScrollViewer</span>&gt;();
			}
 
			<b>return</b> <a href="#0d1da7b7756dc360" class="i field">_scrollViewer</a>;
		}
 
		<b>void</b> <a id="388590b6a7e3ce25" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OnElementItemSelected</a>(<b>object</b> <span id="r54 rd" class="r54 r">sender</span>, <a href="/Xamarin.Forms.Core/A.html#8b9f8c714f679914" class="t t">SelectedItemChangedEventArgs</a> <span id="r55 rd" class="r55 r">e</span>)
		{
			<b>if</b> (<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a> == <b>null</b>)
				<b>return</b>;
 
			<b>if</b> (<a href="#4f5b331400566cf8" class="i field">_deferSelection</a>)
			{
				<span class="c">// If we get more than one of these, that&#39;s okay; we only want the latest one</span>
				<a href="#382c1db37183faa0" class="i field">_deferredSelectedItemChangedEvent</a> = <b>new</b> <span class="i">Tuple</span>&lt;<b>object</b>, <a href="/Xamarin.Forms.Core/A.html#8b9f8c714f679914" class="t t">SelectedItemChangedEventArgs</a>&gt;(<span class="r54 r">sender</span>, <span class="r55 r">e</span>);
				<b>return</b>;
			}
 
			<b>if</b> (<span class="r55 r">e</span>.<a href="/Xamarin.Forms.Core/A.html#e555c9eb6c2cbc99" class="i property">SelectedItem</a> == <b>null</b>)
			{
				<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">SelectedIndex</span> = -1;
				<b>return</b>;
			}
			<a href="/Xamarin.Forms.Core/A.html#5fafd275375b1472" class="k">var</a> <span id="r56 rd" class="r56 r">templatedItems</span> = <a href="#abe61a51a1ac2629" class="i property">TemplatedItemsView</a>.<a href="/Xamarin.Forms.Core/A.html#5c03fae343562417" class="i property">TemplatedItems</a>;
			<b>var</b> <span id="r57 rd" class="r57 r">index</span> = 0;
			<b>if</b> (<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#0b780b61bce76534" class="i property">IsGroupingEnabled</a>)
			{
				<b>int</b> <span id="r58 rd" class="r58 r">selectedItemIndex</span> = <span class="r56 r">templatedItems</span>.<span class="i">GetGlobalIndexOfItem</span>(<span class="r55 r">e</span>.<a href="/Xamarin.Forms.Core/A.html#e555c9eb6c2cbc99" class="i property">SelectedItem</a>);
				<b>var</b> <span id="r59 rd" class="r59 r">leftOver</span> = 0;
				<b>int</b> <span id="r60 rd" class="r60 r">groupIndex</span> = <span class="r56 r">templatedItems</span>.<span class="i">GetGroupIndexFromGlobal</span>(<span class="r58 r">selectedItemIndex</span>, <b>out</b> <span class="r59 r">leftOver</span>);
 
				<span class="r57 r">index</span> = <span class="r58 r">selectedItemIndex</span> - (<span class="r60 r">groupIndex</span> + 1);
			}
			<b>else</b>
			{
				<span class="r57 r">index</span> = <span class="r56 r">templatedItems</span>.<span class="i">GetGlobalIndexOfItem</span>(<span class="r55 r">e</span>.<a href="/Xamarin.Forms.Core/A.html#e555c9eb6c2cbc99" class="i property">SelectedItem</a>);
			}
 
			<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">SelectedIndex</span> = <span class="r57 r">index</span>;
		}
 
		<b>void</b> <a id="0f7d731bf4d76656" href="R/0f7d731bf4d76656.html" target="n" data-glyph="76,1" class="i method">OnListItemClicked</a>(<b>int</b> <span id="r61 rd" class="r61 r">index</span>)
		{
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">WINDOWS_UWP</span>
<span class="e">			// If we&#39;re on the phone , we need to cache the selected item in case the handler 
			// we&#39;re about to call changes any item indexes;
			// in some cases, those index changes will throw an exception we can&#39;t catch if 
			// the listview has an item selected
			object selectedItem = null;
			if (Device.Idiom == TargetIdiom.Phone)
			{
				selectedItem = List.SelectedItem;
				List.SelectedIndex = -1;
				_deferSelection = true;
			}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
			<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<span class="i">NotifyRowTapped</span>(<span class="r61 r">index</span>, <span class="i">cell</span>: <b>null</b>);
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">WINDOWS_UWP</span>
<span class="e">
			if (Device.Idiom != TargetIdiom.Phone || List == null)
			{
				return;
			}
 
			_deferSelection = false;
 
			if (_deferredSelectedItemChangedEvent != null)
			{
				// If there was a selection change attempt while RowTapped was being handled, replay it
				OnElementItemSelected(_deferredSelectedItemChangedEvent.Item1, _deferredSelectedItemChangedEvent.Item2);
				_deferredSelectedItemChangedEvent = null;
			}
			else if (List?.SelectedIndex == -1 &amp;&amp; selectedItem != null)
			{
				// Otherwise, set the selection back to whatever it was before all this started
				List.SelectedItem = selectedItem;
			}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
		}
 
		<b>void</b> <a id="c42a64f8a88ca58c" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OnListItemClicked</a>(<b>object</b> <span id="r62 rd" class="r62 r">sender</span>, <span class="t t">ItemClickEventArgs</span> <span id="r63 rd" class="r63 r">e</span>)
		{
			<b>if</b> (<span class="r63 r">e</span>.<span class="i property">ClickedItem</span> != <b>null</b>)
				<a href="#0f7d731bf4d76656" class="i method">OnListItemClicked</a>(((<span class="t t">WListView</span>)<span class="r63 r">e</span>.<span class="i property">OriginalSource</span>).<span class="i property">Items</span>.<span class="i">IndexOf</span>(<span class="r63 r">e</span>.<span class="i property">ClickedItem</span>));
		}
 
		<b>void</b> <a id="eb9f7aff3fe2a32e" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">OnControlSelectionChanged</a>(<b>object</b> <span id="r64 rd" class="r64 r">sender</span>, <span class="t t">SelectionChangedEventArgs</span> <span id="r65 rd" class="r65 r">e</span>)
		{
			<a href="#525f676b712fbe09" class="i method">RestorePreviousSelectedVisual</a>();
 
			<b>if</b> (<span class="r65 r">e</span>.<span class="i property">AddedItems</span>.<span class="i">Count</span> == 0)
			{
				<span class="c">// Deselecting an item is a valid SelectedItem change.</span>
				<b>if</b> (<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#dfce6372456ec083" class="i property">SelectedItem</a> != <a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">SelectedItem</span>)
				{
					<a href="#0f7d731bf4d76656" class="i method">OnListItemClicked</a>(<a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">SelectedIndex</span>);
				}
 
				<b>return</b>;
			}
 
			<b>object</b> <span id="r66 rd" class="r66 r">cell</span> = <span class="r65 r">e</span>.<span class="i property">AddedItems</span>[0];
			<b>if</b> (<span class="r66 r">cell</span> == <b>null</b>)
				<b>return</b>;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> !<span class="i">WINDOWS_UWP</span>
<span class="e">			if (Device.Idiom == TargetIdiom.Phone)
			{
				FrameworkElement element = FindElement(cell);
				if (element != null)
				{
					SetSelectedVisual(element);
				}
			}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
			<b>if</b> (<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>.<a href="/Xamarin.Forms.Core/A.html#dfce6372456ec083" class="i property">SelectedItem</a> != <a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">SelectedItem</span>)
				((<a href="/Xamarin.Forms.Core/A.html#abc33db1a216ce31" class="t t">IElementController</a>)<a href="VisualElementRenderer.cs.html#320610ddff24e8a8" class="i property">Element</a>).<span class="i">SetValueFromRenderer</span>(<a href="/Xamarin.Forms.Core/A.html#bde8d740ed7039c7" class="t t">ListView</a>.<a href="/Xamarin.Forms.Core/A.html#e2fbab739592c40d" class="i field">SelectedItemProperty</a>, <a href="#40e89181127caa77" class="i property">List</a>.<span class="i property">SelectedItem</span>);
		}
 
		<span class="t t">FrameworkElement</span> <a id="4b6bc73980d0cfaa" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">FindElement</a>(<b>object</b> <span id="r67 rd" class="r67 r">cell</span>)
		{
			<b>foreach</b> (<a href="CellControl.cs.html#ec8f0790cb2e268e" class="t t">CellControl</a> <span id="r68 rd" class="r68 r">selector</span> <b>in</b> <a href="#a90b35952e9c762d" class="i method">FindDescendants</a>&lt;<a href="CellControl.cs.html#ec8f0790cb2e268e" class="t t">CellControl</a>&gt;(<a href="#40e89181127caa77" class="i property">List</a>))
			{
				<b>if</b> (<span class="i">ReferenceEquals</span>(<span class="r67 r">cell</span>, <span class="r68 r">selector</span>.<span class="i property">DataContext</span>))
					<b>return</b> <span class="r68 r">selector</span>;
			}
 
			<b>return null</b>;
		}
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">WINDOWS_UWP</span>
		<b>void</b> <a id="525f676b712fbe09" href="R/525f676b712fbe09.html" target="n" data-glyph="76,1" class="i method">RestorePreviousSelectedVisual</a>()
		{
		}
 
		<b>void</b> <a id="846c419409d29231" href="R/../../0000000000.html" target="n" data-glyph="76,1" class="i method">SetSelectedVisual</a>(<span class="t t">FrameworkElement</span> <span id="r69 rd" class="r69 r">element</span>)
		{
		}
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">		void RestorePreviousSelectedVisual()
		{
			foreach (BrushedElement highlight in _highlightedElements)
			{
				if (highlight.IsBound)
				{
					highlight.Element.SetForeground(highlight.BrushBinding);
				}
				else
				{
					highlight.Element.SetForeground(highlight.Brush);
				}
			}
 
			_highlightedElements.Clear();
		}
 
		void SetSelectedVisual(FrameworkElement element)
		{
			// Find all labels in children and set their foreground color to accent color
			IEnumerable&lt;FrameworkElement&gt; elementsToHighlight = FindPhoneHighlights(element);
			var systemAccentBrush = (Brush)WApp.Current.Resources[&quot;SystemColorControlAccentBrush&quot;];
 
			foreach (FrameworkElement toHighlight in elementsToHighlight)
			{
				Brush brush = null;
				WBinding binding = toHighlight.GetForegroundBinding();
				if (binding == null)
					brush = toHighlight.GetForeground();
 
				var brushedElement = new BrushedElement(toHighlight, binding, brush);
				_highlightedElements.Add(brushedElement);
 
				toHighlight.SetForeground(systemAccentBrush);
			}
		}
 
		IEnumerable&lt;FrameworkElement&gt; FindPhoneHighlights(FrameworkElement element)
		{
			FrameworkElement parent = element;
			while (true)
			{
				element = parent;
				if (element is CellControl)
					break;
 
				parent = VisualTreeHelper.GetParent(element) as FrameworkElement;
				if (parent == null)
				{
					parent = element;
					break;
				}
			}
 
			return FindPhoneHighlightCore(parent);
		}
 
		IEnumerable&lt;FrameworkElement&gt; FindPhoneHighlightCore(DependencyObject element)
		{
			int children = VisualTreeHelper.GetChildrenCount(element);
			for (var i = 0; i &lt; children; i++)
			{
				DependencyObject child = VisualTreeHelper.GetChild(element, i);
 
				var label = child as LabelRenderer;
				var childElement = child as FrameworkElement;
				if (childElement != null &amp;&amp; (GetHighlightWhenSelected(childElement) || label != null))
				{
					if (label != null)
						yield return label.Control;
					else
						yield return childElement;
				}
 
				foreach (FrameworkElement recursedElement in FindPhoneHighlightCore(childElement))
					yield return recursedElement;
			}
		}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
 
		<b>bool</b> <a id="4f5b331400566cf8" href="R/4f5b331400566cf8.html" target="n" data-glyph="46,1" class="i field">_deferSelection</a> = <b>false</b>;
		<span class="i">Tuple</span>&lt;<b>object</b>, <a href="/Xamarin.Forms.Core/A.html#8b9f8c714f679914" class="t t">SelectedItemChangedEventArgs</a>&gt; <a id="382c1db37183faa0" href="R/382c1db37183faa0.html" target="n" data-glyph="46,1" class="i field">_deferredSelectedItemChangedEvent</a>;
	}
}</pre></td></tr></table></div></body></html>
