<!DOCTYPE html>
<html><head><title>TypedBinding.cs</title><link rel="stylesheet" href="../styles.css"><script src="../scripts.js"></script></head>
<body class="cB" onload="i(294);"><div class="dH">
<table style="width: 100%">
<tr><td>File: <a id="filePath" class="blueLink" href="Xamarin.Forms.Core/TypedBinding.cs" target="_top">TypedBinding.cs</a><br/></td><td></td></tr>
<tr><td>Project: <a id="projectPath" class="blueLink" href="/#Xamarin.Forms.Core" target="_top">Xamarin.Forms.Core\Xamarin.Forms.Core.csproj</a> (Xamarin.Forms.Core)</td><td></td></tr>
</table>
</div>
<div class="cz"><table class="tb" cellpadding="0" cellspacing="0"><tr><td valign="top" align="right"><pre id="ln"></pre></td><td valign="top" align="left"><pre id="code">
<span class="k preprocess">#</span><span class="k preprocess">define</span> <span class="i">DO_NOT_CHECK_FOR_BINDING_REUSE</span>
 
<b>using</b> <span class="i n">System</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">ComponentModel</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Globalization</span>;
<b>using</b> <span class="i n">System</span>.<span class="i n">Collections</span>.<span class="i n">Generic</span>;
<b>using</b> <span class="i n">Xamarin</span>.<span class="i n">Forms</span>.<span class="i n">Internals</span>;
 
<b>namespace</b> <span class="i n">Xamarin</span>.<span class="i n">Forms</span>.<span class="i n">Internals</span>
{
	<span class="c">//FIXME: need a better name for this, and share with Binding, so we can share more unittests</span>
	[<a href="@1@System.Runtime/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@System.Runtime/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@System.Runtime/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
	<b>public abstract class</b> <a id="ba04635706f7f784" href="R/ba04635706f7f784.html" target="n" data-glyph="0,0" class="t t">TypedBindingBase</a> : <a href="BindingBase.cs.html#d4b9ac5f0cf91b95" class="t t">BindingBase</a>
	{
		<a href="IValueConverter.cs.html#8c54b2166c66ec65" class="t t">IValueConverter</a> <a id="8ca09ee1f7ffac77" href="R/8ca09ee1f7ffac77.html" target="n" data-glyph="46,1" class="i field">_converter</a>;
		<b>object</b> <a id="ce519cd0ee341963" href="R/ce519cd0ee341963.html" target="n" data-glyph="46,1" class="i field">_converterParameter</a>;
		<b>object</b> <a id="dfd5725564f1c2ff" href="R/dfd5725564f1c2ff.html" target="n" data-glyph="46,1" class="i field">_source</a>;
		<b>string</b> <a id="6c98e400b3319d9d" href="R/6c98e400b3319d9d.html" target="n" data-glyph="46,1" class="i field">_updateSourceEventName</a>;
 
		<b>public</b> <a href="IValueConverter.cs.html#8c54b2166c66ec65" class="t t">IValueConverter</a> <a id="6a9ddb4d61a44709" href="R/6a9ddb4d61a44709.html" target="n" data-glyph="102,1" class="i property">Converter</a> {
			<b>get</b> { <b>return</b> <a href="#8ca09ee1f7ffac77" class="i field">_converter</a>; }
			<b>set</b> {
				<a href="BindingBase.cs.html#c83e8e3ba5dfb4e9" class="i method">ThrowIfApplied</a>();
				<a href="#8ca09ee1f7ffac77" class="i field">_converter</a> = <b>value</b>;
			}
		}
 
		<b>public object</b> <a id="16c69dc2dca80a1b" href="R/16c69dc2dca80a1b.html" target="n" data-glyph="102,1" class="i property">ConverterParameter</a> {
			<b>get</b> { <b>return</b> <a href="#ce519cd0ee341963" class="i field">_converterParameter</a>; }
			<b>set</b> {
				<a href="BindingBase.cs.html#c83e8e3ba5dfb4e9" class="i method">ThrowIfApplied</a>();
				<a href="#ce519cd0ee341963" class="i field">_converterParameter</a> = <b>value</b>;
			}
		}
 
		<b>public object</b> <a id="03b5c48ce634e319" href="R/03b5c48ce634e319.html" target="n" data-glyph="102,1" class="i property">Source</a> {
			<b>get</b> { <b>return</b> <a href="#dfd5725564f1c2ff" class="i field">_source</a>; }
			<b>set</b> {
				<a href="BindingBase.cs.html#c83e8e3ba5dfb4e9" class="i method">ThrowIfApplied</a>();
				<a href="#dfd5725564f1c2ff" class="i field">_source</a> = <b>value</b>;
			}
		}
 
		<b>internal string</b> <a id="0ac7017f874348a9" href="R/0ac7017f874348a9.html" target="n" data-glyph="104,1" class="i property">UpdateSourceEventName</a> {
			<b>get</b> { <b>return</b> <a href="#6c98e400b3319d9d" class="i field">_updateSourceEventName</a>; }
			<b>set</b> {
				<a href="BindingBase.cs.html#c83e8e3ba5dfb4e9" class="i method">ThrowIfApplied</a>();
				<a href="#6c98e400b3319d9d" class="i field">_updateSourceEventName</a> = <b>value</b>;
			}
		}
 
		<b>internal</b> <a id="012c4169fb56a2b3" href="R/../../0000000000.html" target="n" data-glyph="74,1" class="i constructor">TypedBindingBase</a>()
		{
		}
	}
 
	[<a href="@1@System.Runtime/A.html#ab67c52c634f618d" class="t constructor">EditorBrowsable</a>(<a href="@1@System.Runtime/A.html#1a60f7b04af02e88" class="t t">EditorBrowsableState</a>.<a href="@1@System.Runtime/A.html#043ce0a55050bfc5" class="i field">Never</a>)]
	<b>public sealed class</b> <a id="4a3aaa460eb5e2ab" href="R/4a3aaa460eb5e2ab.html" target="n" data-glyph="0,0" class="t t">TypedBinding</a>&lt;<span id="r0 rd t" class="r0 r t">TSource</span>, <span id="r1 rd t" class="r1 r t">TProperty</span>&gt; : <a href="#ba04635706f7f784" class="t t">TypedBindingBase</a>
	{
		<b>readonly</b> <a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <span class="r1 r t">TProperty</span>&gt; <a id="ea52f624a743cae7" href="R/ea52f624a743cae7.html" target="n" data-glyph="46,1" class="i field">_getter</a>;
		<b>readonly</b> <a href="@1@System.Runtime/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<span class="r0 r t">TSource</span>, <span class="r1 r t">TProperty</span>&gt; <a id="e76f89ecb06c7dbe" href="R/e76f89ecb06c7dbe.html" target="n" data-glyph="46,1" class="i field">_setter</a>;
		<b>readonly</b> <a href="#f58e73e44ea3965f" class="t t">PropertyChangedProxy</a> [] <a id="2fb75e771ab0ee60" href="R/2fb75e771ab0ee60.html" target="n" data-glyph="46,1" class="i field">_handlers</a>;
 
		<b>public</b> <a id="fbe7a46ed2a39430" href="R/fbe7a46ed2a39430.html" target="n" data-glyph="72,1" class="i constructor">TypedBinding</a>(<a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <span class="r1 r t">TProperty</span>&gt; <span id="r2 rd" class="r2 r">getter</span>, <a href="@1@System.Runtime/A.html#27863de72c2c9b49" class="t t">Action</a>&lt;<span class="r0 r t">TSource</span>, <span class="r1 r t">TProperty</span>&gt; <span id="r3 rd" class="r3 r">setter</span>, <a href="@1@System.Runtime/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <b>object</b>&gt;, <b>string</b>&gt; [] <span id="r4 rd" class="r4 r">handlers</span>)
		{
			<b>if</b> (<span class="r2 r">getter</span> == <b>null</b>)
				<b>throw</b> <b>new</b> <a href="@1@System.Runtime/A.html#8314938388254d5a" class="t constructor">ArgumentNullException</a>(<b>nameof</b>(<span class="r2 r">getter</span>));
 
			<a href="#ea52f624a743cae7" class="i field">_getter</a> = <span class="r2 r">getter</span>;
			<a href="#e76f89ecb06c7dbe" class="i field">_setter</a> = <span class="r3 r">setter</span>;
 
			<b>if</b> (<span class="r4 r">handlers</span> == <b>null</b>)
				<b>return</b>;
 
			<a href="#2fb75e771ab0ee60" class="i field">_handlers</a> = <b>new</b> <a href="#f58e73e44ea3965f" class="t t">PropertyChangedProxy</a> [<span class="r4 r">handlers</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>];
			<b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r5 rd" class="r5 r">i</span> = 0; <span class="r5 r">i</span> &lt; <span class="r4 r">handlers</span>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r5 r">i</span>++)
				<a href="#2fb75e771ab0ee60" class="i field">_handlers</a> [<span class="r5 r">i</span>] = <b>new</b> <a href="#40032fb0669305f2" class="t constructor">PropertyChangedProxy</a>(<span class="r4 r">handlers</span> [<span class="r5 r">i</span>].<a href="@1@System.Runtime/A.html#d1922db1cf9dcd03" class="i property">Item1</a>, <span class="r4 r">handlers</span> [<span class="r5 r">i</span>].<a href="@1@System.Runtime/A.html#85ddc983cace902c" class="i property">Item2</a>, <a href="#4a3aaa460eb5e2ab" class="k">this</a>);
		}
 
		<b>readonly</b> <a href="@1@System.Runtime/A.html#809df5135c2bec67" class="t t">WeakReference</a>&lt;<b>object</b>&gt; <a id="ea2555e56d9aa97d" href="R/ea2555e56d9aa97d.html" target="n" data-glyph="46,1" class="i field">_weakSource</a> = <b>new</b> <a href="@1@System.Runtime/A.html#0bcc5ece65ea67eb" class="t constructor">WeakReference</a>&lt;<b>object</b>&gt;(<b>null</b>);
		<b>readonly</b> <a href="@1@System.Runtime/A.html#809df5135c2bec67" class="t t">WeakReference</a>&lt;<a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a>&gt; <a id="0f8bebc7e091be67" href="R/0f8bebc7e091be67.html" target="n" data-glyph="46,1" class="i field">_weakTarget</a> = <b>new</b> <a href="@1@System.Runtime/A.html#0bcc5ece65ea67eb" class="t constructor">WeakReference</a>&lt;<a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a>&gt;(<b>null</b>);
		<a href="BindableProperty.cs.html#743d6dd5177e1828" class="t t">BindableProperty</a> <a id="5d7a1d889aa41697" href="R/5d7a1d889aa41697.html" target="n" data-glyph="46,1" class="i field">_targetProperty</a>;
 
		<span class="c">// Applies the binding to a previously set source and target.</span>
		<b>internal override void</b> <a id="32eb32379e206309" href="R/32eb32379e206309.html" target="n" data-glyph="74,1" class="i method">Apply</a>(<b>bool</b> <span id="r6 rd" class="r6 r">fromTarget</span> = <b>false</b>)
		{
			<a href="#ba04635706f7f784" class="k">base</a>.<a href="BindingBase.cs.html#3e1982c75e1e5fd4" class="i method">Apply</a>(<span class="r6 r">fromTarget</span>);
 
			<a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a> <span id="r7 rd" class="r7 r">target</span>;
<span class="k preprocess">#</span><span class="k preprocess">if</span> <span class="i">DO_NOT_CHECK_FOR_BINDING_REUSE</span>
			<b>if</b> (!<a href="#0f8bebc7e091be67" class="i field">_weakTarget</a>.<a href="@1@System.Runtime/A.html#655561bce79c86cd" class="i method">TryGetTarget</a>(<b>out</b> <span class="r7 r">target</span>))
				<b>throw</b> <b>new</b> <a href="@1@System.Runtime/A.html#8d6a52a5496ce078" class="t constructor">InvalidOperationException</a>();
<span class="k preprocess">#</span><span class="k preprocess">else</span>
<span class="e">			if (!_weakTarget.TryGetTarget(out target) || target == null) {
				Unapply();
				return;
			}
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
			<b>object</b> <span id="r8 rd" class="r8 r">source</span>;
			<b>if</b> (<a href="#ea2555e56d9aa97d" class="i field">_weakSource</a>.<a href="@1@System.Runtime/A.html#655561bce79c86cd" class="i method">TryGetTarget</a>(<b>out</b> <span class="r8 r">source</span>) &amp;&amp; <span class="r8 r">source</span> != <b>null</b>)
				<a href="#44fb1d527525c8d7" class="i method">ApplyCore</a>(<span class="r8 r">source</span>, <span class="r7 r">target</span>, <a href="#5d7a1d889aa41697" class="i field">_targetProperty</a>, <span class="r6 r">fromTarget</span>);
		}
 
		<span class="c">// Applies the binding to a new source or target.</span>
		<b>internal override void</b> <a id="98dd64f31c9fbd15" href="R/98dd64f31c9fbd15.html" target="n" data-glyph="74,1" class="i method">Apply</a>(<b>object</b> <span id="r9 rd" class="r9 r">context</span>, <a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a> <span id="r10 rd" class="r10 r">bindObj</span>, <a href="BindableProperty.cs.html#743d6dd5177e1828" class="t t">BindableProperty</a> <span id="r11 rd" class="r11 r">targetProperty</span>)
		{
			<a href="#5d7a1d889aa41697" class="i field">_targetProperty</a> = <span class="r11 r">targetProperty</span>;
			<a href="@1@System.Runtime/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r12 rd" class="r12 r">source</span> = <a href="#03b5c48ce634e319" class="i property">Source</a> ?? <a href="BindingBase.cs.html#b71fb453e66ea93b" class="i property">Context</a> ?? <span class="r9 r">context</span>;
 
<span class="k preprocess">#</span><span class="k preprocess">if</span> (!<span class="i">DO_NOT_CHECK_FOR_BINDING_REUSE</span>)
<span class="e">			base.Apply(source, bindObj, targetProperty);
 
			BindableObject prevTarget;
			if (_weakTarget.TryGetTarget(out prevTarget) &amp;&amp; !ReferenceEquals(prevTarget, bindObj))
				throw new InvalidOperationException(&quot;Binding instances can not be reused&quot;);
 
			object previousSource;
			if (_weakSource.TryGetTarget(out previousSource) &amp;&amp; !ReferenceEquals(previousSource, source))
				throw new InvalidOperationException(&quot;Binding instances can not be reused&quot;);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
			<a href="#ea2555e56d9aa97d" class="i field">_weakSource</a>.<a href="@1@System.Runtime/A.html#3f115199ed47e802" class="i method">SetTarget</a>(<span class="r12 r">source</span>);
			<a href="#0f8bebc7e091be67" class="i field">_weakTarget</a>.<a href="@1@System.Runtime/A.html#3f115199ed47e802" class="i method">SetTarget</a>(<span class="r10 r">bindObj</span>);
 
			<a href="#44fb1d527525c8d7" class="i method">ApplyCore</a>(<span class="r12 r">source</span>, <span class="r10 r">bindObj</span>, <span class="r11 r">targetProperty</span>);
		}
 
		<b>internal override</b> <a href="BindingBase.cs.html#d4b9ac5f0cf91b95" class="t t">BindingBase</a> <a id="cddc69a66c4be25d" href="R/cddc69a66c4be25d.html" target="n" data-glyph="74,1" class="i method">Clone</a>()
		{
			<a href="@1@System.Runtime/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <b>object</b>&gt;, <b>string</b>&gt; [] <span id="r13 rd" class="r13 r">handlers</span> = <a href="#2fb75e771ab0ee60" class="i field">_handlers</a> == <b>null</b> ? <b>null</b> : <b>new</b> <a href="@1@System.Runtime/A.html#1806cf6634f5a371" class="t t">Tuple</a>&lt;<a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <b>object</b>&gt;, <b>string</b>&gt; [<a href="#2fb75e771ab0ee60" class="i field">_handlers</a>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>];
			<b>if</b> (<span class="r13 r">handlers</span> != <b>null</b>) {
				<b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r14 rd" class="r14 r">i</span> = 0; <span class="r14 r">i</span> &lt; <a href="#2fb75e771ab0ee60" class="i field">_handlers</a>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r14 r">i</span>++)
					<span class="r13 r">handlers</span> [<span class="r14 r">i</span>] = <b>new</b> <a href="@1@System.Runtime/A.html#ee1efa9bd0176f36" class="t constructor">Tuple</a>&lt;<a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <b>object</b>&gt;, <b>string</b>&gt;(<a href="#2fb75e771ab0ee60" class="i field">_handlers</a> [<span class="r14 r">i</span>].<a href="#952639e68ed74d56" class="i property">PartGetter</a>, <a href="#2fb75e771ab0ee60" class="i field">_handlers</a> [<span class="r14 r">i</span>].<a href="#f0d1cb6a4c8498ea" class="i property">PropertyName</a>);
			}
			<b>return</b> <b>new</b> <a href="#fbe7a46ed2a39430" class="t constructor">TypedBinding</a>&lt;<span class="r0 r t">TSource</span>, <span class="r1 r t">TProperty</span>&gt;(<a href="#ea52f624a743cae7" class="i field">_getter</a>, <a href="#e76f89ecb06c7dbe" class="i field">_setter</a>, <span class="r13 r">handlers</span>) {
				<a href="BindingBase.cs.html#6a8c8005d33f1648" class="i property">Mode</a> = <a href="BindingBase.cs.html#6a8c8005d33f1648" class="i property">Mode</a>,
				<a href="#6a9ddb4d61a44709" class="i property">Converter</a> = <a href="#6a9ddb4d61a44709" class="i property">Converter</a>,
				<a href="#16c69dc2dca80a1b" class="i property">ConverterParameter</a> = <a href="#16c69dc2dca80a1b" class="i property">ConverterParameter</a>,
				<a href="BindingBase.cs.html#845414db5f9480a5" class="i property">StringFormat</a> = <a href="BindingBase.cs.html#845414db5f9480a5" class="i property">StringFormat</a>,
				<a href="#03b5c48ce634e319" class="i property">Source</a> = <a href="#03b5c48ce634e319" class="i property">Source</a>,
				<a href="#0ac7017f874348a9" class="i property">UpdateSourceEventName</a> = <a href="#0ac7017f874348a9" class="i property">UpdateSourceEventName</a>,
			};
		}
 
		<b>internal override object</b> <a id="3f6b6014f893d618" href="R/3f6b6014f893d618.html" target="n" data-glyph="74,1" class="i method">GetSourceValue</a>(<b>object</b> <span id="r15 rd" class="r15 r">value</span>, <a href="@1@System.Runtime/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r16 rd" class="r16 r">targetPropertyType</span>)
		{
			<b>if</b> (<a href="#6a9ddb4d61a44709" class="i property">Converter</a> != <b>null</b>)
				<span class="r15 r">value</span> = <a href="#6a9ddb4d61a44709" class="i property">Converter</a>.<a href="IValueConverter.cs.html#0930b4947b3f7de4" class="i method">Convert</a>(<span class="r15 r">value</span>, <span class="r16 r">targetPropertyType</span>, <a href="#16c69dc2dca80a1b" class="i property">ConverterParameter</a>, <span class="t t">CultureInfo</span>.<span class="i property">CurrentUICulture</span>);
 
			<span class="c">//return base.GetSourceValue(value, targetPropertyType);</span>
			<b>if</b> (<a href="BindingBase.cs.html#845414db5f9480a5" class="i property">StringFormat</a> != <b>null</b>)
				<b>return string</b>.<a href="@1@System.Runtime/A.html#ad9f5b0b214ae8f3" class="i method">Format</a>(<a href="BindingBase.cs.html#845414db5f9480a5" class="i property">StringFormat</a>, <span class="r15 r">value</span>);
 
			<b>return</b> <span class="r15 r">value</span>;
		}
 
		<b>internal override object</b> <a id="de9094d0a823dbf4" href="R/de9094d0a823dbf4.html" target="n" data-glyph="74,1" class="i method">GetTargetValue</a>(<b>object</b> <span id="r17 rd" class="r17 r">value</span>, <a href="@1@System.Runtime/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r18 rd" class="r18 r">sourcePropertyType</span>)
		{
			<b>if</b> (<a href="#6a9ddb4d61a44709" class="i property">Converter</a> != <b>null</b>)
				<span class="r17 r">value</span> = <a href="#6a9ddb4d61a44709" class="i property">Converter</a>.<a href="IValueConverter.cs.html#03444acec9dd02ac" class="i method">ConvertBack</a>(<span class="r17 r">value</span>, <span class="r18 r">sourcePropertyType</span>, <a href="#16c69dc2dca80a1b" class="i property">ConverterParameter</a>, <span class="t t">CultureInfo</span>.<span class="i property">CurrentUICulture</span>);
 
			<span class="c">//return base.GetTargetValue(value, sourcePropertyType);</span>
			<b>return</b> <span class="r17 r">value</span>;
		}
 
		<b>internal override void</b> <a id="17a8e0d66a21b78e" href="R/17a8e0d66a21b78e.html" target="n" data-glyph="74,1" class="i method">Unapply</a>()
		{
<span class="k preprocess">#</span><span class="k preprocess">if</span> (!<span class="i">DO_NOT_CHECK_FOR_BINDING_REUSE</span>)
<span class="e">			base.Unapply();
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
			<b>if</b> (<a href="#2fb75e771ab0ee60" class="i field">_handlers</a> != <b>null</b>)
				<a href="#5d8293be193014ab" class="i method">Unsubscribe</a>();
			
<span class="k preprocess">#</span><span class="k preprocess">if</span> (!<span class="i">DO_NOT_CHECK_FOR_BINDING_REUSE</span>)
<span class="e">			_weakSource.SetTarget(null);
			_weakTarget.SetTarget(null);
</span><span class="k preprocess">#</span><span class="k preprocess">endif</span>
		}
 
		<span class="c">// ApplyCore is as slim as it should be:</span>
		<span class="c">// Setting  100000 values						: 17ms.</span>
		<span class="c">// ApplyCore  100000 (w/o INPC, w/o unnapply)	: 20ms.</span>
		<b>internal void</b> <a id="44fb1d527525c8d7" href="R/44fb1d527525c8d7.html" target="n" data-glyph="74,1" class="i method">ApplyCore</a>(<b>object</b> <span id="r19 rd" class="r19 r">sourceObject</span>, <a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a> <span id="r20 rd" class="r20 r">target</span>, <a href="BindableProperty.cs.html#743d6dd5177e1828" class="t t">BindableProperty</a> <span id="r21 rd" class="r21 r">property</span>, <b>bool</b> <span id="r22 rd" class="r22 r">fromTarget</span> = <b>false</b>)
		{
			<a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r23 rd" class="r23 r">isTSource</span> = <span class="r19 r">sourceObject</span> != <b>null</b> &amp;&amp; <span class="r19 r">sourceObject</span> <b>is</b> <span class="r0 r t">TSource</span>;
			<a href="BindingMode.cs.html#fc1bd67c74123628" class="k">var</a> <span id="r24 rd" class="r24 r">mode</span> = <a href="#4a3aaa460eb5e2ab" class="k">this</a>.<a href="BindingBaseExtensions.cs.html#a7773b8e58e2cdaa" class="i method">GetRealizedMode</a>(<span class="r21 r">property</span>);
			<b>if</b> (<span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#464911f604460d5c" class="i field">OneWay</a> &amp;&amp; <span class="r22 r">fromTarget</span>)
				<b>return</b>;
 
			<a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r25 rd" class="r25 r">needsGetter</span> = (<span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#5b5de329b5adbce9" class="i field">TwoWay</a> &amp;&amp; !<span class="r22 r">fromTarget</span>) || <span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#464911f604460d5c" class="i field">OneWay</a>;
 
			<b>if</b> (<span class="r23 r">isTSource</span> &amp;&amp; (<span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#464911f604460d5c" class="i field">OneWay</a> || <span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#5b5de329b5adbce9" class="i field">TwoWay</a>) &amp;&amp; <a href="#2fb75e771ab0ee60" class="i field">_handlers</a> != <b>null</b>)
				<a href="#e3ca1a0cfe7448fc" class="i method">Subscribe</a>((<span class="r0 r t">TSource</span>)<span class="r19 r">sourceObject</span>);
 
			<b>if</b> (<span class="r25 r">needsGetter</span>) {
				<a href="@1@System.Runtime/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r26 rd" class="r26 r">value</span> = <span class="r21 r">property</span>.<a href="BindableProperty.cs.html#b20da29b32c9aaff" class="i property">DefaultValue</a>;
				<b>if</b> (<span class="r23 r">isTSource</span>) {
					<b>try</b> {
						<span class="r26 r">value</span> = <a href="#3f6b6014f893d618" class="i method">GetSourceValue</a>(<a href="#ea52f624a743cae7" class="i field">_getter</a>((<span class="r0 r t">TSource</span>)<span class="r19 r">sourceObject</span>), <span class="r21 r">property</span>.<a href="BindableProperty.cs.html#3a88e13a70e1553a" class="i property">ReturnType</a>);
					} <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r27 rd" class="r27 r">ex</span>) <b>when</b> (<span class="r27 r">ex</span> <b>is</b> <a href="@1@System.Runtime/A.html#2d739200b2282eb9" class="t t">NullReferenceException</a> || <span class="r27 r">ex</span> <b>is</b> <a href="@1@System.Runtime/A.html#4e5d8fbb690f6391" class="t t">KeyNotFoundException</a>) {
					}
				}
				<b>if</b> (!<a href="#284ce4e4c891d8a3" class="i method">TryConvert</a>(<b>ref</b> <span class="r26 r">value</span>, <span class="r21 r">property</span>, <span class="r21 r">property</span>.<a href="BindableProperty.cs.html#3a88e13a70e1553a" class="i property">ReturnType</a>, <b>true</b>)) {
					<a href="Log.cs.html#43dda5e5ea5ad8f9" class="t t">Log</a>.<a href="Log.cs.html#1776263ebad4afea" class="i method">Warning</a>(<span class="s">&quot;Binding&quot;</span>, <span class="s">&quot;{0} can not be converted to type &#39;{1}&#39;&quot;</span>, <span class="r26 r">value</span>, <span class="r21 r">property</span>.<a href="BindableProperty.cs.html#3a88e13a70e1553a" class="i property">ReturnType</a>);
					<b>return</b>;
				}
				<span class="r20 r">target</span>.<a href="BindableObject.cs.html#cdda2e5893c76fb1" class="i method">SetValueCore</a>(<span class="r21 r">property</span>, <span class="r26 r">value</span>, <a href="BindableObject.cs.html#4e46d9514e6a0d85" class="t t">SetValueFlags</a>.<a href="BindableObject.cs.html#f96104604fccfe26" class="i field">ClearDynamicResource</a>, <a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a>.<a href="BindableObject.cs.html#b7cf4bc942d04eaa" class="t t">SetValuePrivateFlags</a>.<a href="BindableObject.cs.html#8eb48006e0d48d47" class="i field">Default</a> | <a href="BindableObject.cs.html#804aed41f6e6b7c8" class="t t">BindableObject</a>.<a href="BindableObject.cs.html#b7cf4bc942d04eaa" class="t t">SetValuePrivateFlags</a>.<a href="BindableObject.cs.html#a9b94e4dc44be024" class="i field">Converted</a>);
				<b>return</b>;
			}
 
			<a href="@1@System.Runtime/A.html#f1b135ff6c380b37" class="k">var</a> <span id="r28 rd" class="r28 r">needsSetter</span> = (<span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#5b5de329b5adbce9" class="i field">TwoWay</a> &amp;&amp; <span class="r22 r">fromTarget</span>) || <span class="r24 r">mode</span> == <a href="BindingMode.cs.html#fc1bd67c74123628" class="t t">BindingMode</a>.<a href="BindingMode.cs.html#5827e0a716ae341d" class="i field">OneWayToSource</a>;
			<b>if</b> (<span class="r28 r">needsSetter</span> &amp;&amp; <a href="#e76f89ecb06c7dbe" class="i field">_setter</a> != <b>null</b> &amp;&amp; <span class="r23 r">isTSource</span>) {
				<a href="@1@System.Runtime/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r29 rd" class="r29 r">value</span> = <a href="#de9094d0a823dbf4" class="i method">GetTargetValue</a>(<span class="r20 r">target</span>.<a href="BindableObject.cs.html#00e81fee0b400c43" class="i method">GetValue</a>(<span class="r21 r">property</span>), <b>typeof</b>(<span class="r1 r t">TProperty</span>));
				<b>if</b> (!<a href="#284ce4e4c891d8a3" class="i method">TryConvert</a>(<b>ref</b> <span class="r29 r">value</span>, <span class="r21 r">property</span>, <b>typeof</b>(<span class="r1 r t">TProperty</span>), <b>false</b>)) {
					<a href="Log.cs.html#43dda5e5ea5ad8f9" class="t t">Log</a>.<a href="Log.cs.html#1776263ebad4afea" class="i method">Warning</a>(<span class="s">&quot;Binding&quot;</span>, <span class="s">&quot;{0} can not be converted to type &#39;{1}&#39;&quot;</span>, <span class="r29 r">value</span>, <b>typeof</b>(<span class="r1 r t">TProperty</span>));
					<b>return</b>;
				}
				<a href="#e76f89ecb06c7dbe" class="i field">_setter</a>((<span class="r0 r t">TSource</span>)<span class="r19 r">sourceObject</span>, (<span class="r1 r t">TProperty</span>)<span class="r29 r">value</span>);
			}
		}
 
		<b>static bool</b> <a id="284ce4e4c891d8a3" href="R/284ce4e4c891d8a3.html" target="n" data-glyph="76,1" class="i method">TryConvert</a>(<b>ref object</b> <span id="r30 rd" class="r30 r">value</span>, <a href="BindableProperty.cs.html#743d6dd5177e1828" class="t t">BindableProperty</a> <span id="r31 rd" class="r31 r">targetProperty</span>, <a href="@1@System.Runtime/A.html#3d00eeab9feb80f3" class="t t">Type</a> <span id="r32 rd" class="r32 r">convertTo</span>, <b>bool</b> <span id="r33 rd" class="r33 r">toTarget</span>)
		{
			<b>if</b> (<span class="r30 r">value</span> == <b>null</b>)
				<b>return true</b>;
			<b>if</b> ((<span class="r33 r">toTarget</span> &amp;&amp; <span class="r31 r">targetProperty</span>.<a href="BindableProperty.cs.html#c50e83cb086bedd0" class="i method">TryConvert</a>(<b>ref</b> <span class="r30 r">value</span>)) || (!<span class="r33 r">toTarget</span> &amp;&amp; <span class="r32 r">convertTo</span>.<a href="ReflectionExtensions.cs.html#8c499ef170a390f5" class="i method">IsInstanceOfType</a>(<span class="r30 r">value</span>)))
				<b>return true</b>;
 
			<b>object</b> <span id="r34 rd" class="r34 r">original</span> = <span class="r30 r">value</span>;
			<b>try</b> {
				<span class="r30 r">value</span> = <span class="t t">Convert</span>.<span class="i method">ChangeType</span>(<span class="r30 r">value</span>, <span class="r32 r">convertTo</span>, <span class="t t">CultureInfo</span>.<span class="i property">InvariantCulture</span>);
				<b>return true</b>;
			} <b>catch</b> (<a href="@1@System.Runtime/A.html#f092fb2b893a0162" class="t t">Exception</a> <span id="r35 rd" class="r35 r">ex</span> ) <b>when</b> (<span class="r35 r">ex</span> <b>is</b> <a href="@1@System.Runtime/A.html#e9f84ee35463e2da" class="t t">InvalidCastException</a> || <span class="r35 r">ex</span> <b>is</b> <a href="@1@System.Runtime/A.html#80a470d64a9b80ef" class="t t">FormatException</a>||<span class="r35 r">ex</span> <b>is</b> <a href="@1@System.Runtime/A.html#0b6129dd66924863" class="t t">OverflowException</a>) {
				<span class="r30 r">value</span> = <span class="r34 r">original</span>;
				<b>return false</b>;
			}
		}
 
		<b>class</b> <a id="f58e73e44ea3965f" href="R/f58e73e44ea3965f.html" target="n" data-glyph="4,1" class="t t">PropertyChangedProxy</a>
		{
			<b>public</b> <a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <b>object</b>&gt; <a id="952639e68ed74d56" href="R/952639e68ed74d56.html" target="n" data-glyph="102,2" class="i property">PartGetter</a> { <b>get</b>; }
			<b>public string</b> <a id="f0d1cb6a4c8498ea" href="R/f0d1cb6a4c8498ea.html" target="n" data-glyph="102,2" class="i property">PropertyName</a> { <b>get</b>; }
			<b>public</b> <a href="BindingExpression.cs.html#2aec715b3c2631f3" class="t t">BindingExpression</a>.<a href="BindingExpression.cs.html#29d44b9ae98fd539" class="t t">WeakPropertyChangedProxy</a> <a id="ae7673580cfec4b0" href="R/ae7673580cfec4b0.html" target="n" data-glyph="102,2" class="i property">Listener</a> { <b>get</b>; }
			<a href="@1@System.Runtime/A.html#809df5135c2bec67" class="t t">WeakReference</a>&lt;<span class="t t">INotifyPropertyChanged</span>&gt; <a id="8377d63fd9379bed" href="R/8377d63fd9379bed.html" target="n" data-glyph="46,2" class="i field">_weakPart</a> = <b>new</b> <a href="@1@System.Runtime/A.html#0bcc5ece65ea67eb" class="t constructor">WeakReference</a>&lt;<span class="t t">INotifyPropertyChanged</span>&gt;(<b>null</b>);
			<b>readonly</b> <a href="BindingBase.cs.html#d4b9ac5f0cf91b95" class="t t">BindingBase</a> <a id="c4db0dd340101b09" href="R/c4db0dd340101b09.html" target="n" data-glyph="46,2" class="i field">_binding</a>;
 
			<b>public</b> <span class="t t">INotifyPropertyChanged</span> <a id="fe429c499be8c08a" href="R/fe429c499be8c08a.html" target="n" data-glyph="102,2" class="i property">Part</a> {
				<b>get</b> {
					<span class="t t">INotifyPropertyChanged</span> <span id="r36 rd" class="r36 r">target</span>;
					<b>if</b> (<a href="#8377d63fd9379bed" class="i field">_weakPart</a>.<a href="@1@System.Runtime/A.html#655561bce79c86cd" class="i method">TryGetTarget</a>(<b>out</b> <span class="r36 r">target</span>))
						<b>return</b> <span class="r36 r">target</span>;
					<b>return null</b>;
				} 
				<b>set</b> {
					<a href="#8377d63fd9379bed" class="i field">_weakPart</a>.<a href="@1@System.Runtime/A.html#3f115199ed47e802" class="i method">SetTarget</a>(<b>value</b>);
					<a href="#ae7673580cfec4b0" class="i property">Listener</a>.<a href="BindingExpression.cs.html#5a9554d4cccf1048" class="i method">SubscribeTo</a>(<b>value</b>, <a href="#bcb580c9f48c369d" class="i method">OnPropertyChanged</a>);
				}
			}
 
			<b>public</b> <a id="40032fb0669305f2" href="R/40032fb0669305f2.html" target="n" data-glyph="72,2" class="i constructor">PropertyChangedProxy</a>(<a href="@1@System.Runtime/A.html#7a86aba051da82dd" class="t t">Func</a>&lt;<span class="r0 r t">TSource</span>, <b>object</b>&gt; <span id="r37 rd" class="r37 r">partGetter</span>, <b>string</b> <span id="r38 rd" class="r38 r">propertyName</span>, <a href="BindingBase.cs.html#d4b9ac5f0cf91b95" class="t t">BindingBase</a> <span id="r39 rd" class="r39 r">binding</span>)
			{
				<a href="#952639e68ed74d56" class="i property">PartGetter</a> = <span class="r37 r">partGetter</span>;
				<a href="#f0d1cb6a4c8498ea" class="i property">PropertyName</a> = <span class="r38 r">propertyName</span>;
				<a href="#c4db0dd340101b09" class="i field">_binding</a> = <span class="r39 r">binding</span>;
				<a href="#ae7673580cfec4b0" class="i property">Listener</a> = <b>new</b> <a href="BindingExpression.cs.html#2aec715b3c2631f3" class="t t">BindingExpression</a>.<a href="BindingExpression.cs.html#6864c3075d7218f5" class="t constructor">WeakPropertyChangedProxy</a>();
			}
 
			<b>void</b> <a id="bcb580c9f48c369d" href="R/bcb580c9f48c369d.html" target="n" data-glyph="76,2" class="i method">OnPropertyChanged</a>(<b>object</b> <span id="r40 rd" class="r40 r">sender</span>, <span class="t t">PropertyChangedEventArgs</span> <span id="r41 rd" class="r41 r">e</span>)
			{
				<b>if</b> (!<b>string</b>.<a href="@1@System.Runtime/A.html#23a8597f842071f4" class="i method">IsNullOrEmpty</a>(<span class="r41 r">e</span>.<span class="i property">PropertyName</span>) &amp;&amp; <b>string</b>.<a href="@1@System.Runtime/A.html#0601c3adfb08dab2" class="i method">CompareOrdinal</a>(<span class="r41 r">e</span>.<span class="i property">PropertyName</span>, <a href="#f0d1cb6a4c8498ea" class="i property">PropertyName</a>) != 0)
					<b>return</b>;
				<a href="Device.cs.html#4809323d42d3030a" class="t t">Device</a>.<a href="Device.cs.html#c01f48f642e0b305" class="i method">BeginInvokeOnMainThread</a>(() =&gt; <a href="#c4db0dd340101b09" class="i field">_binding</a>.<a href="BindingBase.cs.html#3e1982c75e1e5fd4" class="i method">Apply</a>(<b>false</b>));
			}
		}
 
		<b>void</b> <a id="e3ca1a0cfe7448fc" href="R/e3ca1a0cfe7448fc.html" target="n" data-glyph="76,1" class="i method">Subscribe</a>(<span class="r0 r t">TSource</span> <span id="r42 rd" class="r42 r">sourceObject</span>)
		{
			<b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r43 rd" class="r43 r">i</span> = 0; <span class="r43 r">i</span> &lt; <a href="#2fb75e771ab0ee60" class="i field">_handlers</a>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r43 r">i</span>++) {
				<a href="@1@System.Runtime/A.html#d9262ceecc1719ab" class="k">var</a> <span id="r44 rd" class="r44 r">part</span> = <a href="#2fb75e771ab0ee60" class="i field">_handlers</a> [<span class="r43 r">i</span>].<a href="#952639e68ed74d56" class="i property">PartGetter</a>(<span class="r42 r">sourceObject</span>);
				<b>if</b> (<span class="r44 r">part</span> == <b>null</b>)
					<b>break</b>;
				<b>var</b> <span id="r45 rd" class="r45 r">inpc</span> = <span class="r44 r">part</span> <b>as</b> <span class="t t">INotifyPropertyChanged</span>;
				<b>if</b> (<span class="r45 r">inpc</span> == <b>null</b>)
					<b>continue</b>;
				<a href="#2fb75e771ab0ee60" class="i field">_handlers</a> [<span class="r43 r">i</span>].<a href="#fe429c499be8c08a" class="i property">Part</a> = (<span class="r45 r">inpc</span>);
			}
		}
 
		<b>void</b> <a id="5d8293be193014ab" href="R/5d8293be193014ab.html" target="n" data-glyph="76,1" class="i method">Unsubscribe</a>()
		{
			<b>for</b> (<a href="@1@System.Runtime/A.html#225942ed7b7a3252" class="k">var</a> <span id="r46 rd" class="r46 r">i</span> = 0; <span class="r46 r">i</span> &lt; <a href="#2fb75e771ab0ee60" class="i field">_handlers</a>.<a href="@1@System.Runtime/A.html#42e9b7616956cf94" class="i property">Length</a>; <span class="r46 r">i</span>++)
				<a href="#2fb75e771ab0ee60" class="i field">_handlers</a> [<span class="r46 r">i</span>].<a href="#ae7673580cfec4b0" class="i property">Listener</a>.<a href="BindingExpression.cs.html#b87cd87a79098265" class="i method">Unsubscribe</a>();
		}
	}
}</pre></td></tr></table></div></body></html>
